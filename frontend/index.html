<!DOCTYPE html>
<html lang="en">
<head>
  <title>Scythe</title>
  <link href="./static/lib/bootstrap-4.0.0-alpha.5-dist/css/bootstrap.min.css" rel="stylesheet" />
  <link rel="stylesheet" type="text/css" href="./static/css/main.css" />

  <script src="./static/scripts/jquery-3.1.1.js" type="text/javascript" charset="utf-8"></script>
  <script src="./static/lib/ace-builds/src-noconflict/ace.js" type="text/javascript" charset="utf-8"></script>
  
  <script src="./static/lib/d3/d3.js" type="text/javascript" charset="utf-8"></script>
  <script src="./static/scripts/d3-tip.js" type="text/javascript" charset="utf-8"></script>

  <script src="./static/scripts/util.js" type="text/javascript" charset="utf-8"></script>
  
  <script src="./static/lib/jquery-ui-1.12.1.custom/jquery-ui.js" type="text/javascript" charset="utf-8"></script>
  <script src="./static/scripts/jquery.fileupload.js" type="text/javascript" charset="utf-8"></script>

  <link rel="stylesheet" type="text/css" href="./static/lib/DataTables/media/css/jquery.datatables.css">
  <script type="text/javascript" charset="utf8" src="./static/lib/DataTables/media/js/jquery.dataTables.js"></script>
</head>
<body>
  <nav class="navbar">
    <ul class="nav navbar-nav">
      <li class="nav-item active">
        <a class="nav-link" href="#">Home <span class="sr-only">(current)</span></a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="#">About</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="#">Contact</a>
      </li>
    </ul>
  </nav>
  <h1>Scythe</h1>
  <h3 class="subtitle">Building Your Visualization Using Examples.</h3>
  <div class="panel">
      <label class="btn btn-primary">
        Load Data <input id="fileupload" type="file"  style="display: none;" name="files[]" multiple>
      </label>
      <label class="btn btn-success">
        Synthesize <input id="synthesize" type="submit" style="display: none;">
      </label>
  </div>
  <div class="container">
    <div id="wrapper">
      <div id="input-example">
        <div class="tbl"></div>
      </div>
      <div id="output-example">
        <div class="tbl"></div>
      </div>
      <div id="viz"></div>
    </div>
    <hr/>
  </div>
  <!-- /.container -->
</body>
<script>

// handle "synthesize" event
$(function () {
  $('.submit-btn').click(function () {
    var example = "";
    $.ajax({
      url: '/scythe',
      method: 'POST',
      data: {
        "example": example
      },
      success: function (data) {
        console.log(data);
        $("#feedback").html(htmlForTextWithEmbeddedNewlines(data.substring(1, data.length - 1)));
      }
    });
  });
});

// event handler for uploading files
$(function () {
  // Add click event handler to button
  $('#fileupload' ).on("change", function () {
    if ( ! window.FileReader ) {
      return alert( 'FileReader API is not supported by your browser.' );
    }
    var $i = $('#fileupload'), // Put file input ID here
      input = $i[0]; // Getting the element from jQuery
    if (input.files) {
      for (var i = 0; i < input.files.length; i ++) {
        (function(file) {
          var reader = new FileReader();  
          reader.onload = function () {
          
            // test displaying onload files
            //$('#file-content').append( $( '<div/>' ).html( reader.result ));

            file_content = reader.result;
            csvdata = d3.csvParse(file_content);
            gen_histogram(csvdata, "#viz");

            var input_table = tabulate(csvdata, ["xval", "yval"], "#input-example");
            var output_table = tabulate(csvdata, ["xval", "yval"], "#output-example");

          };
          reader.readAsText(file, "UTF-8");
        })(input.files[i]);          
      }
    } else {
      // Handle errors here
      alert( "File not selected or browser incompatible." )
    }
  });
});

$(document).ready( function () {

  $('#table_id').DataTable( {
      scrollY:        400,
      scrollCollapse: true,
      deferRender:    true,
      paging:         false,
      bFilter:        false, 
      bInfo:          false
  });

  $('#table_id tbody').on( 'click', 'tr', function () {
    $(this).toggleClass('selected');
  });
} );
</script>
</html>