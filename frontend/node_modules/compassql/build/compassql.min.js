!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.cql=e()}}(function(){var e;return function t(e,n,r){function i(a,u){if(!n[a]){if(!e[a]){var c="function"==typeof require&&require;if(!u&&c)return c(a,!0);if(o)return o(a,!0);var s=new Error("Cannot find module '"+a+"'");throw s.code="MODULE_NOT_FOUND",s}var l=n[a]={exports:{}};e[a][0].call(l.exports,function(t){var n=e[a][1][t];return i(n?n:t)},l,l.exports,t,e,n,r)}return n[a].exports}for(var o="function"==typeof require&&require,a=0;a<r.length;a++)i(r[a]);return i}({1:[function(e,t,n){"use strict";function r(e){return a({},n.DEFAULT_QUERY_CONFIG,e,{"enum":i(e["enum"])})}function i(e){var t=a({},s.DEFAULT_ENUM_INDEX,e,{binProps:o(e,"bin"),scaleProps:o(e,"scale"),axisProps:o(e,"axis"),legendProps:o(e,"legend")});return t}function o(e,t){return a({},s.DEFAULT_ENUM_INDEX[t+"Props"],e[t+"Props"])}var a=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e},u=e("vega-lite/build/src/channel"),c=e("./property"),s=e("./wildcard");n.DEFAULT_QUERY_CONFIG={verbose:!1,defaultSpecConfig:{overlay:{line:!0},scale:{useUnaggregatedDomain:!0}},propertyPrecedence:c.DEFAULT_PROP_PRECEDENCE.map(c.toKey),"enum":s.DEFAULT_ENUM_INDEX,numberNominalProportion:.05,numberNominalLimit:40,constraintManuallySpecifiedValue:!1,autoAddCount:!1,hasAppropriateGraphicTypeForMark:!0,omitAggregate:!1,omitAggregatePlotWithDimensionOnlyOnFacet:!0,omitAggregatePlotWithoutDimension:!1,omitBarLineAreaWithOcclusion:!0,omitBarTickWithSize:!0,omitMultipleNonPositionalChannels:!0,omitNonSumStack:!0,omitRaw:!1,omitRawContinuousFieldForAggregatePlot:!0,omitRepeatedField:!0,omitNonPositionalOrFacetOverPositionalChannels:!0,omitTableWithOcclusionIfAutoAddCount:!0,omitVerticalDotPlot:!1,preferredBinAxis:u.Channel.X,preferredTemporalAxis:u.Channel.X,preferredOrdinalAxis:u.Channel.Y,preferredNominalAxis:u.Channel.Y,preferredFacet:u.Channel.ROW,maxCardinalityForCategoricalColor:20,maxCardinalityForFacet:20,maxCardinalityForShape:6,timeUnitShouldHaveVariation:!0,typeMatchesSchemaType:!0,stylize:!0,smallRangeStepForHighCardinalityOrFacet:{maxCardinality:10,rangeStep:12},nominalColorScaleForHighCardinality:{maxCardinality:10,palette:"category20"},xAxisOnTopForHighYCardinalityWithoutColumn:{maxCardinality:30},maxGoodCardinalityForFacet:5,maxGoodCardinalityForColor:7},n.extendConfig=r},{"./property":11,"./wildcard":36,"vega-lite/build/src/channel":53}],2:[function(e,t,n){"use strict";var r=function(){function e(e){this.constraint=e}return e.prototype.name=function(){return this.constraint.name},e.prototype.description=function(){return this.constraint.description},e.prototype.properties=function(){return this.constraint.properties},e.prototype.strict=function(){return this.constraint.strict},e}();n.AbstractConstraintModel=r},{}],3:[function(e,t,n){"use strict";function r(e,t,n,r,i,o){for(var a=v.get(e)||[],u=r.getEncodingQueryByIndex(n),c=0,s=a;c<s.length;c++){var l=s[c];if(l.strict()||o[l.name()]){var d=l.satisfy(u,i,r.wildcardIndex.encodings[n],o);if(!d){var f="(enc) "+l.name();return o.verbose&&console.log(f+" failed with "+r.toShorthand()+" for "+t.name),f}}}for(var p=E.get(e)||[],y=0,g=p;y<g.length;y++){var l=g[y];if((l.strict()||o[l.name()])&&h.isValueQuery(u)){var d=l.satisfy(u,i,r.wildcardIndex.encodings[n],o);if(!d){var f="(enc) "+l.name();return o.verbose&&console.log(f+" failed with "+r.toShorthand()+" for "+t.name),f}}}return null}var i=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},o=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e},a=e("vega-lite/build/src/channel"),u=e("vega-lite/build/src/fielddef"),c=e("vega-lite/build/src/scale"),s=e("vega-lite/build/src/type"),l=e("./base"),d=e("../property"),f=e("../propindex"),p=e("../wildcard"),y=e("../schema"),g=e("../util"),h=e("../query/encoding"),m=function(e){function t(t){return e.call(this,t)||this}return i(t,e),t.prototype.hasAllRequiredPropertiesSpecific=function(e){return g.every(this.constraint.properties,function(t){if(d.isEncodingNestedProp(t)){var n=t.parent,r=t.child;return!e[n]||!p.isWildcard(e[n][r])}return!e[t]||!p.isWildcard(e[t])})},t.prototype.satisfy=function(e,t,n,r){return!this.constraint.allowWildcardForProperties&&!this.hasAllRequiredPropertiesSpecific(e)||this.constraint.satisfy(e,t,n,r)},t}(l.AbstractConstraintModel);n.EncodingConstraintModel=m,n.FIELD_CONSTRAINTS=[{name:"aggregateOpSupportedByType",description:"Aggregate function should be supported by data type.",properties:[d.Property.TYPE,d.Property.AGGREGATE],allowWildcardForProperties:!1,strict:!0,satisfy:function(e,t,n,r){return!e.aggregate||e.type!==s.Type.ORDINAL&&e.type!==s.Type.NOMINAL}},{name:"asteriskFieldWithCountOnly",description:'Field="*" should be disallowed except aggregate="count"',properties:[d.Property.FIELD,d.Property.AGGREGATE],allowWildcardForProperties:!1,strict:!0,satisfy:function(e,t,n,r){return"*"===e.field==("count"===e.aggregate)}},{name:"binAppliedForQuantitative",description:"bin should be applied to quantitative field only.",properties:[d.Property.TYPE,d.Property.BIN],allowWildcardForProperties:!1,strict:!0,satisfy:function(e,t,n,r){return!e.bin||e.type===s.Type.QUANTITATIVE}},{name:"channelFieldCompatible",description:"encoding channel's range type be compatible with channel type.",properties:[d.Property.CHANNEL,d.Property.TYPE,d.Property.BIN,d.Property.TIMEUNIT],allowWildcardForProperties:!1,strict:!0,satisfy:function(e,t,n,r){var i=o({field:"f"},h.toFieldDef(e,["bin","timeUnit","type"]));return u.channelCompatibility(i,e.channel).compatible}},{name:"hasFn",description:"A field with as hasFn flag should have one of aggregate, timeUnit, or bin.",properties:[d.Property.AGGREGATE,d.Property.BIN,d.Property.TIMEUNIT],allowWildcardForProperties:!0,strict:!0,satisfy:function(e,t,n,r){return!e.hasFn||(!!e.aggregate||!!e.bin||!!e.timeUnit)}},{name:"omitScaleZeroWithBinnedField",description:"Do not use scale zero with binned field",properties:[d.Property.SCALE,d.getEncodingNestedProp("scale","zero"),d.Property.BIN],allowWildcardForProperties:!1,strict:!0,satisfy:function(e,t,n,r){return!e.bin||!e.scale||e.scale.zero!==!0}},{name:"onlyOneTypeOfFunction",description:"Only of of aggregate, autoCount, timeUnit, or bin should be applied at the same time.",properties:[d.Property.AGGREGATE,d.Property.AUTOCOUNT,d.Property.TIMEUNIT,d.Property.BIN],allowWildcardForProperties:!0,strict:!0,satisfy:function(e,t,n,r){var i=(!p.isWildcard(e.aggregate)&&e.aggregate?1:0)+(!p.isWildcard(e.autoCount)&&e.autoCount?1:0)+(!p.isWildcard(e.bin)&&e.bin?1:0)+(!p.isWildcard(e.timeUnit)&&e.timeUnit?1:0);return i<=1}},{name:"timeUnitAppliedForTemporal",description:"Time unit should be applied to temporal field only.",properties:[d.Property.TYPE,d.Property.TIMEUNIT],allowWildcardForProperties:!1,strict:!0,satisfy:function(e,t,n,r){return!e.timeUnit||e.type===s.Type.TEMPORAL}},{name:"timeUnitShouldHaveVariation",description:"A particular time unit should be applied only if they produce unique values.",properties:[d.Property.TIMEUNIT,d.Property.TYPE],allowWildcardForProperties:!1,strict:!1,satisfy:function(e,t,n,r){return!e.timeUnit||e.type!==s.Type.TEMPORAL||(!n.has("timeUnit")&&!r.constraintManuallySpecifiedValue||t.timeUnitHasVariation(e))}},{name:"scalePropertiesSupportedByScaleType",description:"Scale properties must be supported by correct scale type",properties:[].concat(d.SCALE_PROPS,[d.Property.SCALE,d.Property.TYPE]),allowWildcardForProperties:!0,strict:!0,satisfy:function(e,t,n,r){if(e.scale){var i=e.scale,o=h.scaleType(e);if(void 0===o||null===o)return!0;for(var a in i)if("type"!==a&&"name"!==a&&"enum"!==a){var u=a;if("point"===o){if(!c.scaleTypeSupportProperty("point",u)&&!c.scaleTypeSupportProperty("band",u))return!1}else if(!c.scaleTypeSupportProperty(o,u))return!1}}return!0}},{name:"scalePropertiesSupportedByChannel",description:"Not all scale properties are supported by all encoding channels",properties:[].concat(d.SCALE_PROPS,[d.Property.SCALE,d.Property.CHANNEL]),allowWildcardForProperties:!0,strict:!0,satisfy:function(e,t,n,r){if(e){var i=e.channel,o=e.scale;if(i&&!p.isWildcard(i)&&o)for(var a in o)if(o.hasOwnProperty(a)&&"type"!==a&&"name"!==a&&"enum"!==a){var u=void 0===c.channelScalePropertyIncompatability(i,a);if(!u)return!1}}return!0}},{name:"typeMatchesPrimitiveType",description:"Data type should be supported by field's primitive type.",properties:[d.Property.FIELD,d.Property.TYPE],allowWildcardForProperties:!1,strict:!0,satisfy:function(e,t,n,r){if("*"===e.field)return!0;var i=t.primitiveType(e.field),o=e.type;if(!n.has("field")&&!n.has("type")&&!r.constraintManuallySpecifiedValue)return!0;switch(i){case y.PrimitiveType.BOOLEAN:case y.PrimitiveType.STRING:return o!==s.Type.QUANTITATIVE&&o!==s.Type.TEMPORAL;case y.PrimitiveType.NUMBER:case y.PrimitiveType.INTEGER:return o!==s.Type.TEMPORAL;case y.PrimitiveType.DATE:return o===s.Type.TEMPORAL;case null:return!1}throw new Error("Not implemented")}},{name:"typeMatchesSchemaType",description:"Enumerated data type of a field should match the field's type in the schema.",properties:[d.Property.FIELD,d.Property.TYPE],allowWildcardForProperties:!1,strict:!1,satisfy:function(e,t,n,r){return!(n.has("field")||n.has("type")||r.constraintManuallySpecifiedValue)||("*"===e.field?e.type===s.Type.QUANTITATIVE:t.type(e.field)===e.type)}},{name:"maxCardinalityForCategoricalColor",description:"Categorical channel should not have too high cardinality",properties:[d.Property.CHANNEL,d.Property.FIELD],allowWildcardForProperties:!1,strict:!1,satisfy:function(e,t,n,r){return e.channel!==a.Channel.COLOR||e.type!==s.Type.NOMINAL||t.cardinality(e)<=r.maxCardinalityForCategoricalColor}},{name:"maxCardinalityForFacet",description:"Row/column channel should not have too high cardinality",properties:[d.Property.CHANNEL,d.Property.FIELD,d.Property.BIN,d.Property.TIMEUNIT],allowWildcardForProperties:!1,strict:!1,satisfy:function(e,t,n,r){return e.channel!==a.Channel.ROW&&e.channel!==a.Channel.COLUMN||t.cardinality(e)<=r.maxCardinalityForFacet}},{name:"maxCardinalityForShape",description:"Shape channel should not have too high cardinality",properties:[d.Property.CHANNEL,d.Property.FIELD,d.Property.BIN,d.Property.TIMEUNIT],allowWildcardForProperties:!1,strict:!1,satisfy:function(e,t,n,r){return e.channel!==a.Channel.SHAPE||t.cardinality(e)<=r.maxCardinalityForShape}},{name:"dataTypeAndFunctionMatchScaleType",description:"Scale type must match data type",properties:[d.Property.TYPE,d.Property.SCALE,d.getEncodingNestedProp("scale","type"),d.Property.TIMEUNIT,d.Property.BIN],allowWildcardForProperties:!1,strict:!0,satisfy:function(e,t,n,r){if(e.scale){var i=e.type,o=h.scaleType(e);if(g.contains([s.Type.ORDINAL,s.Type.NOMINAL],i))return void 0===o||c.hasDiscreteDomain(o);if(i===s.Type.TEMPORAL)return e.timeUnit?g.contains([c.ScaleType.TIME,c.ScaleType.UTC,void 0],o)||c.hasDiscreteDomain(o):g.contains([c.ScaleType.TIME,c.ScaleType.UTC,void 0],o);if(i===s.Type.QUANTITATIVE)return e.bin?g.contains([c.ScaleType.LINEAR,void 0],o):g.contains([c.ScaleType.LOG,c.ScaleType.POW,c.ScaleType.SQRT,c.ScaleType.QUANTILE,c.ScaleType.QUANTIZE,c.ScaleType.LINEAR,void 0],o)}return!0}}].map(function(e){return new m(e)}),n.FIELD_CONSTRAINT_INDEX=n.FIELD_CONSTRAINTS.reduce(function(e,t){return e[t.name()]=t,e},{});var v=n.FIELD_CONSTRAINTS.reduce(function(e,t){for(var n=0,r=t.properties();n<r.length;n++){var i=r[n];e.set(i,e.get(i)||[]),e.get(i).push(t)}return e},new f.PropIndex);n.VALUE_CONSTRAINTS=[{name:"doesNotSupportConstantValue",description:"row, column, x, y, and detail should not work with constant values.",properties:[d.Property.TYPE,d.Property.AGGREGATE],allowWildcardForProperties:!1,strict:!0,satisfy:function(e,t,n,r){return!g.contains(["row","column","x","y","detail"],e.channel)}}].map(function(e){return new m(e)}),n.VALUE_CONSTRAINT_INDEX=n.VALUE_CONSTRAINTS.reduce(function(e,t){return e[t.name()]=t,e},{});var E=n.FIELD_CONSTRAINTS.reduce(function(e,t){for(var n=0,r=t.properties();n<r.length;n++){var i=r[n];e.set(i,e.get(i)||[]),e.get(i).push(t)}return e},new f.PropIndex);n.checkEncoding=r},{"../property":11,"../propindex":12,"../query/encoding":13,"../schema":33,"../util":35,"../wildcard":36,"./base":2,"vega-lite/build/src/channel":53,"vega-lite/build/src/fielddef":56,"vega-lite/build/src/scale":60,"vega-lite/build/src/type":62}],4:[function(e,t,n){"use strict";var r=e("./encoding");n.encoding=r;var i=e("./spec");n.spec=i},{"./encoding":3,"./spec":5}],5:[function(e,t,n){"use strict";function r(e,t,n,r,i){for(var o=v.get(e)||[],a=0,u=o;a<u.length;a++){var c=u[a];if(c.strict()||i[c.name()]){var s=c.satisfy(n,r,i);if(!s){var l="(spec) "+c.name();return i.verbose&&console.log(l+" failed with "+n.toShorthand()+" for "+t.name),l}}}return null}var i=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},o=e("vega-lite/build/src/aggregate"),a=e("vega-lite/build/src/channel"),u=e("vega-lite/build/src/mark"),c=e("vega-lite/build/src/scale"),s=e("vega-lite/build/src/type"),l=e("./base"),d=e("../wildcard"),f=e("../property"),p=e("../propindex"),y=e("../util"),g=e("../query/encoding"),h=a.NONSPATIAL_CHANNELS.reduce(function(e,t){return e[t]=!0,e},{}),m=function(e){function t(t){return e.call(this,t)||this}return i(t,e),t.prototype.hasAllRequiredPropertiesSpecific=function(e){return y.every(this.constraint.properties,function(t){if(t===f.Property.MARK)return!d.isWildcard(e.getMark());if(f.isEncodingNestedProp(t)){var n=t.parent,r=t.child;return y.every(e.getEncodings(),function(e){return!e[n]||!d.isWildcard(e[n][r])})}if(!f.isEncodingProperty(t))throw new Error("UNIMPLEMENTED");return y.every(e.getEncodings(),function(e){return!e[t]||!d.isWildcard(e[t])})})},t.prototype.satisfy=function(e,t,n){return!this.constraint.allowWildcardForProperties&&!this.hasAllRequiredPropertiesSpecific(e)||this.constraint.satisfy(e,t,n)},t}(l.AbstractConstraintModel);n.SpecConstraintModel=m,n.SPEC_CONSTRAINTS=[{name:"noRepeatedChannel",description:"Each encoding channel should only be used once.",properties:[f.Property.CHANNEL],allowWildcardForProperties:!0,strict:!0,satisfy:function(e,t,n){var r={};return y.every(e.getEncodings(),function(e){return!!d.isWildcard(e.channel)||!r[e.channel]&&(r[e.channel]=!0,!0)})}},{name:"alwaysIncludeZeroInScaleWithBarMark",description:"Do not recommend bar mark if scale does not start at zero",properties:[f.Property.MARK,f.Property.SCALE,f.getEncodingNestedProp("scale","zero"),f.Property.CHANNEL,f.Property.TYPE],allowWildcardForProperties:!1,strict:!0,satisfy:function(e,t,n){var r=e.getMark(),i=e.getEncodings();if(r===u.Mark.BAR)for(var o=0,c=i;o<c.length;o++){var l=c[o];if(g.isFieldQuery(l)&&(l.channel===a.Channel.X||l.channel===a.Channel.Y)&&l.type===s.Type.QUANTITATIVE&&l.scale&&l.scale.zero===!1)return!1}return!0}},{name:"autoAddCount",description:"Automatically adding count only for plots with only ordinal, binned quantitative, or temporal with timeunit fields.",properties:[f.Property.BIN,f.Property.TIMEUNIT,f.Property.TYPE,f.Property.AUTOCOUNT],allowWildcardForProperties:!0,strict:!1,satisfy:function(e,t,n){var r=y.some(e.getEncodings(),function(e){return g.isFieldQuery(e)&&e.autoCount===!0});if(r)return y.every(e.getEncodings(),function(e){if(g.isValueQuery(e))return!1;if(void 0!==e.autoCount)return!0;switch(e.type){case s.Type.QUANTITATIVE:return!!e.bin;case s.Type.TEMPORAL:return!!e.timeUnit;case s.Type.ORDINAL:case s.Type.NOMINAL:return!0}throw new Error("Unsupported Type")});var i=e.wildcardIndex.encodingIndicesByProperty.get("autoCount")||[],o=y.every(i,function(t){var n=e.getEncodingQueryByIndex(t);return g.isFieldQuery(n)&&!d.isWildcard(n.autoCount)});return!o||y.some(e.getEncodings(),function(e){return g.isFieldQuery(e)&&e.type===s.Type.QUANTITATIVE?e.autoCount!==!1&&(!e.bin||d.isWildcard(e.bin)):!(!g.isFieldQuery(e)||e.type!==s.Type.TEMPORAL)&&(!e.timeUnit||d.isWildcard(e.timeUnit))})}},{name:"channelPermittedByMarkType",description:"Each encoding channel should be supported by the mark type",properties:[f.Property.CHANNEL,f.Property.MARK],allowWildcardForProperties:!0,strict:!0,satisfy:function(e,t,n){var r=e.getMark();return!!d.isWildcard(r)||y.every(e.getEncodings(),function(e){return!!d.isWildcard(e.channel)||a.supportMark(e.channel,r)})}},{name:"hasAllRequiredChannelsForMark",description:"All required channels for the specified mark should be specified",properties:[f.Property.CHANNEL,f.Property.MARK],allowWildcardForProperties:!1,strict:!0,satisfy:function(e,t,n){var r=e.getMark();switch(r){case u.Mark.AREA:case u.Mark.LINE:return e.channelUsed(a.Channel.X)&&e.channelUsed(a.Channel.Y);case u.Mark.TEXT:return e.channelUsed(a.Channel.TEXT);case u.Mark.BAR:case u.Mark.CIRCLE:case u.Mark.SQUARE:case u.Mark.TICK:case u.Mark.RULE:return e.channelUsed(a.Channel.X)||e.channelUsed(a.Channel.Y);case u.Mark.POINT:return!e.wildcardIndex.hasProperty(f.Property.CHANNEL)||e.channelUsed(a.Channel.X)||e.channelUsed(a.Channel.Y)}throw new Error("hasAllRequiredChannelsForMark not implemented for mark"+JSON.stringify(r))}},{name:"omitAggregate",description:"Omit aggregate plots.",properties:[f.Property.AGGREGATE,f.Property.AUTOCOUNT],allowWildcardForProperties:!0,strict:!1,satisfy:function(e,t,n){return!e.isAggregate()}},{name:"omitAggregatePlotWithDimensionOnlyOnFacet",description:"All required channels for the specified mark should be specified",properties:[f.Property.CHANNEL,f.Property.AGGREGATE,f.Property.AUTOCOUNT],allowWildcardForProperties:!1,strict:!1,satisfy:function(e,t,n){if(e.isAggregate()){var r=!1,i=!1,o=!1;if(e.specQuery.encodings.forEach(function(t,n){g.isValueQuery(t)||t.autoCount===!1||t.aggregate||t.autoCount||(i=!0,y.contains([a.Channel.ROW,a.Channel.COLUMN],t.channel)?e.wildcardIndex.hasEncodingProperty(n,f.Property.CHANNEL)&&(o=!0):r=!0)}),i&&!r&&(o||n.constraintManuallySpecifiedValue))return!1}return!0}},{name:"omitAggregatePlotWithoutDimension",description:"Aggregate plots without dimension should be omitted",properties:[f.Property.AGGREGATE,f.Property.AUTOCOUNT,f.Property.BIN,f.Property.TIMEUNIT,f.Property.TYPE],allowWildcardForProperties:!1,strict:!1,satisfy:function(e,t,n){return!e.isAggregate()||y.some(e.getEncodings(),function(e){return!!g.isDiscrete(e)})}},{name:"omitBarLineAreaWithOcclusion",description:"Don't use bar, line or area to visualize raw plot as they often lead to occlusion.",properties:[f.Property.MARK,f.Property.AGGREGATE,f.Property.AUTOCOUNT],allowWildcardForProperties:!1,strict:!1,satisfy:function(e,t,n){return!y.contains([u.Mark.BAR,u.Mark.LINE,u.Mark.AREA],e.getMark())||e.isAggregate()}},{name:"omitBarTickWithSize",description:"Do not map field to size channel with bar and tick mark",properties:[f.Property.CHANNEL,f.Property.MARK],allowWildcardForProperties:!0,strict:!1,satisfy:function(e,t,n){var r=e.getMark();if(y.contains([u.Mark.TICK,u.Mark.BAR],r)&&e.channelUsed(a.Channel.SIZE)){if(n.constraintManuallySpecifiedValue)return!1;for(var i=e.specQuery.encodings,o=0;o<i.length;o++){var c=i[o];if(c.channel===a.Channel.SIZE)return!e.wildcardIndex.hasEncodingProperty(o,f.Property.CHANNEL)}}return!0}},{name:"omitBarAreaForLogScale",description:"Do not use bar and area mark for x and y's log scale",properties:[f.Property.MARK,f.Property.CHANNEL,f.Property.SCALE,f.getEncodingNestedProp("scale","type"),f.Property.TYPE],allowWildcardForProperties:!1,strict:!0,satisfy:function(e,t,n){var r=e.getMark(),i=e.getEncodings();if(r===u.Mark.AREA||r===u.Mark.BAR)for(var o=0,s=i;o<s.length;o++){var l=s[o];if(g.isFieldQuery(l)&&(l.channel===a.Channel.X||l.channel===a.Channel.Y)&&l.scale){var d=g.scaleType(l);if(d===c.ScaleType.LOG)return!1}}return!0}},{name:"omitMultipleNonPositionalChannels",description:"Unless manually specified, do not use multiple non-positional encoding channel to avoid over-encoding.",properties:[f.Property.CHANNEL],allowWildcardForProperties:!0,strict:!1,satisfy:function(e,t,n){for(var r=e.specQuery.encodings,i=0,o=!1,a=0;a<r.length;a++){var u=r[a];if(!g.isValueQuery(u)&&u.autoCount!==!1){var c=u.channel;if(!d.isWildcard(c)&&h[c+""]&&(i+=1,e.wildcardIndex.hasEncodingProperty(a,f.Property.CHANNEL)&&(o=!0),i>1&&(o||n.constraintManuallySpecifiedValue)))return!1}}return!0}},{name:"omitNonPositionalOrFacetOverPositionalChannels",description:"Do not use non-positional channels unless all positional channels are used",properties:[f.Property.CHANNEL],allowWildcardForProperties:!1,strict:!1,satisfy:function(e,t,n){for(var r=e.specQuery.encodings,i=!1,o=!1,u=!1,c=!1,s=0;s<r.length;s++){var l=r[s];if(!g.isValueQuery(l)&&l.autoCount!==!1){var p=l.channel;p===a.Channel.X?u=!0:p===a.Channel.Y?c=!0:d.isWildcard(p)||(i=!0,e.wildcardIndex.hasEncodingProperty(s,f.Property.CHANNEL)&&(o=!0))}}return!(o||n.constraintManuallySpecifiedValue&&i)||u&&c}},{name:"omitRaw",description:"Omit raw plots.",properties:[f.Property.AGGREGATE,f.Property.AUTOCOUNT],allowWildcardForProperties:!1,strict:!1,satisfy:function(e,t,n){return!!e.isAggregate()}},{name:"omitRawContinuousFieldForAggregatePlot",description:"Aggregate plot should not use raw continuous field as group by values. (Quantitative should be binned. Temporal should have time unit.)",properties:[f.Property.AGGREGATE,f.Property.AUTOCOUNT,f.Property.TIMEUNIT,f.Property.BIN,f.Property.TYPE],allowWildcardForProperties:!0,strict:!1,satisfy:function(e,t,n){if(e.isAggregate())for(var r=e.specQuery.encodings,i=0;i<r.length;i++){var o=r[i];if(!g.isValueQuery(o)&&o.autoCount!==!1){if(o.type===s.Type.TEMPORAL&&!o.timeUnit&&(e.wildcardIndex.hasEncodingProperty(i,f.Property.TIMEUNIT)||n.constraintManuallySpecifiedValue))return!1;if(o.type===s.Type.QUANTITATIVE&&!o.bin&&!o.aggregate&&!o.autoCount){if(e.wildcardIndex.hasEncodingProperty(i,f.Property.BIN)||e.wildcardIndex.hasEncodingProperty(i,f.Property.AGGREGATE)||e.wildcardIndex.hasEncodingProperty(i,f.Property.AUTOCOUNT))return!1;if(n.constraintManuallySpecifiedValue)return!1}}}return!0}},{name:"omitRawDetail",description:"Do not use detail channel with raw plot.",properties:[f.Property.CHANNEL,f.Property.AGGREGATE,f.Property.AUTOCOUNT],allowWildcardForProperties:!1,strict:!0,satisfy:function(e,t,n){return!!e.isAggregate()||y.every(e.specQuery.encodings,function(t,r){return!(!g.isValueQuery(t)&&t.autoCount!==!1)||(t.channel!==a.Channel.DETAIL||!e.wildcardIndex.hasEncodingProperty(r,f.Property.CHANNEL)&&!n.constraintManuallySpecifiedValue)})}},{name:"omitRepeatedField",description:"Each field should be mapped to only one channel",properties:[f.Property.FIELD],allowWildcardForProperties:!0,strict:!1,satisfy:function(e,t,n){for(var r={},i={},o=e.specQuery.encodings,a=0;a<o.length;a++){var u=o[a];if(!g.isValueQuery(u)&&u.field&&!d.isWildcard(u.field)){var c=u.field;if(e.wildcardIndex.hasEncodingProperty(a,f.Property.FIELD)&&(i[c]=!0),r[c]&&(i[c]||n.constraintManuallySpecifiedValue))return!1;r[c]=!0}}return!0}},{name:"omitVerticalDotPlot",description:"Do not output vertical dot plot.",properties:[f.Property.CHANNEL],allowWildcardForProperties:!0,strict:!1,satisfy:function(e,t,n){var r=e.getEncodings();return 1!==r.length||r[0].channel!==a.Channel.Y}},{name:"hasAppropriateGraphicTypeForMark",description:"Has appropriate graphic type for mark",properties:[f.Property.CHANNEL,f.Property.MARK,f.Property.TYPE,f.Property.TIMEUNIT,f.Property.BIN,f.Property.AGGREGATE,f.Property.AUTOCOUNT],allowWildcardForProperties:!1,strict:!1,satisfy:function(e,t,n){var r=e.getMark();switch(r){case u.Mark.AREA:case u.Mark.LINE:if(e.isAggregate()){var i=e.getEncodingQueryByChannel(a.Channel.X),o=e.getEncodingQueryByChannel(a.Channel.Y),c=i&&g.isContinuous(i),l=o&&g.isContinuous(o);return i&&o&&c!==l&&!(g.isFieldQuery(i)&&!c&&i.type===s.Type.NOMINAL)&&!(g.isFieldQuery(o)&&!l&&o.type===s.Type.NOMINAL)}return!0;case u.Mark.TEXT:return!0;case u.Mark.BAR:case u.Mark.TICK:if(e.channelUsed(a.Channel.SIZE))return!1;var i=e.getEncodingQueryByChannel(a.Channel.X),o=e.getEncodingQueryByChannel(a.Channel.Y),d=i&&g.isContinuous(i),f=o&&g.isContinuous(o);return d!==f;case u.Mark.CIRCLE:case u.Mark.POINT:case u.Mark.SQUARE:case u.Mark.RULE:return!0}throw new Error("hasAllRequiredChannelsForMark not implemented for mark"+r)}},{name:"omitNonLinearScaleTypeWithStack",description:"Stacked plot should only use linear scale",properties:[f.Property.CHANNEL,f.Property.MARK,f.Property.AGGREGATE,f.Property.AUTOCOUNT,f.Property.SCALE,f.getEncodingNestedProp("scale","type"),f.Property.TYPE],allowWildcardForProperties:!1,strict:!0,satisfy:function(e,t,n){var r=e.stack();if(r)for(var i=0,o=e.getEncodings();i<o.length;i++){var u=o[i];if(!g.isValueQuery(u)&&(u.aggregate||u.autoCount===!0)&&u.type===s.Type.QUANTITATIVE&&y.contains([a.Channel.X,a.Channel.Y],u.channel)&&g.scaleType(u)!==c.ScaleType.LINEAR)return!1}return!0}},{name:"omitNonSumStack",description:"Stacked plot should use summative aggregation such as sum, count, or distinct",properties:[f.Property.CHANNEL,f.Property.MARK,f.Property.AGGREGATE,f.Property.AUTOCOUNT],allowWildcardForProperties:!1,strict:!1,satisfy:function(e,t,n){var r=e.stack();if(r){var i=e.getEncodingQueryByChannel(r.fieldChannel);return g.isFieldQuery(i)&&(y.contains(o.SUM_OPS,i.aggregate)||!!i.autoCount)}return!0}},{name:"omitTableWithOcclusionIfAutoAddCount",description:"Plots without aggregation or autocount where x and y are both discrete should be omitted if autoAddCount is enabled as they often lead to occlusion",properties:[f.Property.CHANNEL,f.Property.TYPE,f.Property.TIMEUNIT,f.Property.BIN,f.Property.AGGREGATE,f.Property.AUTOCOUNT],allowWildcardForProperties:!1,strict:!1,satisfy:function(e,t,n){if(n.autoAddCount){var r=e.getEncodingQueryByChannel("x"),i=e.getEncodingQueryByChannel("y");if(g.isDiscrete(r)&&g.isDiscrete(i)&&!e.isAggregate())return!1}return!0}}].map(function(e){return new m(e)}),n.SPEC_CONSTRAINT_INDEX=n.SPEC_CONSTRAINTS.reduce(function(e,t){return e[t.name()]=t,e},{});var v=n.SPEC_CONSTRAINTS.reduce(function(e,t){for(var n=0,r=t.properties();n<r.length;n++){var i=r[n];e.set(i,e.get(i)||[]),e.get(i).push(t)}return e},new p.PropIndex);n.checkSpec=r},{"../property":11,"../propindex":12,"../query/encoding":13,"../util":35,"../wildcard":36,"./base":2,"vega-lite/build/src/aggregate":50,"vega-lite/build/src/channel":53,"vega-lite/build/src/mark":59,"vega-lite/build/src/scale":60,"vega-lite/build/src/type":62}],6:[function(e,t,n){"use strict";n.version="0.11.0",n.config=e("./config"),n.constraint=e("./constraint"),n.enumerate=e("./enumerator"),n.wildcard=e("./wildcard");var r=e("./generate");n.generate=r.generate,n.model=e("./model"),n.nest=e("./nest"),n.property=e("./property"),n.query=e("./query"),n.ranking=e("./ranking/ranking");var i=e("./recommend");n.recommend=i.recommend,n.schema=e("./schema"),n.util=e("./util")},{"./config":1,"./constraint":4,"./enumerator":7,"./generate":8,"./model":9,"./nest":10,"./property":11,"./query":15,"./ranking/ranking":31,"./recommend":32,"./schema":33,"./util":35,"./wildcard":36}],7:[function(e,t,n){"use strict";function r(e){return l.get(e)}function i(e){return function(t,n,r){return function(i,u){function c(d){if(d===l.length)return void i.push(u.duplicate());var f=l[d],p=t.encodings[f].get(e),y=u.getEncodingQueryByIndex(f),g=u.getEncodingProperty(f,e);s.isValueQuery(y)||y.autoCount===!1||!g?c(d+1):(p["enum"].forEach(function(t){null===t&&(t=void 0),u.setEncodingProperty(f,e,t,p);var i=o.checkEncoding(e,p,f,u,n,r);if(!i){var s=a.checkSpec(e,p,u,n,r);s||c(d+1)}}),u.resetEncodingProperty(f,e,p))}var l=t.encodingIndicesByProperty.get(e);return c(0),i}}}var o=e("./constraint/encoding"),a=e("./constraint/spec"),u=e("./property"),c=e("./propindex"),s=e("./query/encoding"),l=new c.PropIndex;n.getEnumerator=r,l.set("mark",function(e,t,n){return function(r,i){var o=i.getMark();return o["enum"].forEach(function(o){i.setMark(o);var u=a.checkSpec("mark",e.mark,i,t,n);u||r.push(i.duplicate())}),i.resetMark(),r}}),u.ENCODING_TOPLEVEL_PROPS.forEach(function(e){l.set(e,i(e))}),u.ENCODING_NESTED_PROPS.forEach(function(e){l.set(e,i(e))}),n.EncodingPropertyGeneratorFactory=i},{"./constraint/encoding":3,"./constraint/spec":5,"./property":11,"./propindex":12,"./query/encoding":13}],8:[function(e,t,n){"use strict";function r(e,t,n){void 0===n&&(n=i.DEFAULT_QUERY_CONFIG);var r=a.SpecQueryModel.build(e,t,n),s=r.wildcardIndex,l=[r];return n.propertyPrecedence.forEach(function(e){var r=u.fromKey(e);if(s.hasProperty(r)){var i=o.getEnumerator(r),a=i(s,t,n);l=l.reduce(a,[])}}),!n.stylize||null===n.nominalColorScaleForHighCardinality&&null===n.smallRangeStepForHighCardinalityOrFacet&&null===n.xAxisOnTopForHighYCardinalityWithoutColumn?l:c.stylize(l,t,n)}var i=e("./config"),o=e("./enumerator"),a=e("./model"),u=e("./property"),c=e("./stylize");n.generate=r},{"./config":1,"./enumerator":7,"./model":9,"./property":11,"./stylize":34}],9:[function(e,t,n){"use strict";var r=e("vega-lite/build/src/type"),i=e("./property"),o=e("./wildcard"),a=e("./wildcardindex"),u=e("./query/spec"),c=e("./query/encoding"),s=e("./query/groupby"),l=e("./query/shorthand"),d=e("./util"),f=function(){function e(e,t,n,r,i){this._rankingScore={},this._spec=e,this._channelFieldCount=e.encodings.reduce(function(e,t){return c.isFieldQuery(t)&&!o.isWildcard(t.channel)&&t.autoCount!==!1&&(e[t.channel+""]=1),e},{}),this._wildcardIndex=t,this._assignedWildcardIndex=i,this._opt=r,this._schema=n}return e.build=function(t,n,u){var s=new a.WildcardIndex;if(o.isWildcard(t.mark)){var l=o.getDefaultName(i.Property.MARK);t.mark=o.initWildcard(t.mark,l,u["enum"].mark),s.setMark(t.mark)}if(t.encodings.forEach(function(e,t){c.isFieldQuery(e)&&void 0!==e.autoCount&&(console.warn("A field with autoCount should not be included as autoCount meant to be an internal object."),e.type=r.Type.QUANTITATIVE),c.isFieldQuery(e)&&void 0===e.type&&(e.type=o.SHORT_WILDCARD),i.ENCODING_TOPLEVEL_PROPS.forEach(function(r){if(o.isWildcard(e[r])){var i=o.getDefaultName(r)+t,a=o.getDefaultEnumValues(r,n,u),c=e[r]=o.initWildcard(e[r],i,a);s.setEncodingProperty(t,r,c)}}),i.ENCODING_NESTED_PROPS.forEach(function(r){var i=e[r.parent];if(i){var a=r.child;if(o.isWildcard(i[a])){var c=o.getDefaultName(r)+t,l=o.getDefaultEnumValues(r,n,u),d=i[a]=o.initWildcard(i[a],c,l);s.setEncodingProperty(t,r,d)}}})}),u.autoAddCount){var d={channel:{name:o.getDefaultName(i.Property.CHANNEL)+t.encodings.length,"enum":o.getDefaultEnumValues(i.Property.CHANNEL,n,u)},autoCount:{name:o.getDefaultName(i.Property.AUTOCOUNT)+t.encodings.length,"enum":[!1,!0]},type:r.Type.QUANTITATIVE};t.encodings.push(d);var f=t.encodings.length-1;s.setEncodingProperty(f,i.Property.CHANNEL,d.channel),s.setEncodingProperty(f,i.Property.AUTOCOUNT,d.autoCount)}return new e(t,s,n,u,{})},Object.defineProperty(e.prototype,"wildcardIndex",{get:function(){return this._wildcardIndex},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"schema",{get:function(){return this._schema},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"specQuery",{get:function(){return this._spec},enumerable:!0,configurable:!0}),e.prototype.duplicate=function(){return new e(d.duplicate(this._spec),this._wildcardIndex,this._schema,this._opt,d.duplicate(this._assignedWildcardIndex))},e.prototype.setMark=function(e){var t=this._spec.mark.name;this._assignedWildcardIndex[t]=this._spec.mark=e},e.prototype.resetMark=function(){
var e=this._spec.mark=this._wildcardIndex.mark;delete this._assignedWildcardIndex[e.name]},e.prototype.getMark=function(){return this._spec.mark},e.prototype.getEncodingProperty=function(e,t){var n=this._spec.encodings[e];return i.isEncodingNestedProp(t)?n[t.parent][t.child]:n[t]},e.prototype.setEncodingProperty=function(e,t,n,r){var a=this._spec.encodings[e];t===i.Property.CHANNEL&&a.channel&&!o.isWildcard(a.channel)&&this._channelFieldCount[a.channel]--,i.isEncodingNestedProp(t)?a[t.parent][t.child]=n:i.hasNestedProperty(t)&&n===!0?a[t]=d.extend({},a[t],{"enum":void 0,name:void 0}):a[t]=n,this._assignedWildcardIndex[r.name]=n,t===i.Property.CHANNEL&&(this._channelFieldCount[n]=(this._channelFieldCount[n]||0)+1)},e.prototype.resetEncodingProperty=function(e,t,n){var r=this._spec.encodings[e];t===i.Property.CHANNEL&&this._channelFieldCount[r.channel]--,i.isEncodingNestedProp(t)?r[t.parent][t.child]=n:r[t]=n,delete this._assignedWildcardIndex[n.name]},e.prototype.channelUsed=function(e){return this._channelFieldCount[e]>0},e.prototype.stack=function(){return u.stack(this._spec)},e.prototype.getEncodings=function(){return this._spec.encodings.filter(function(e){return c.isValueQuery(e)||e.autoCount!==!1})},e.prototype.getEncodingQueryByChannel=function(e){for(var t=0,n=this._spec.encodings;t<n.length;t++){var r=n[t];if(r.channel===e)return r}},e.prototype.getEncodingQueryByIndex=function(e){return this._spec.encodings[e]},e.prototype.isAggregate=function(){return u.isAggregate(this._spec)},e.prototype.toShorthand=function(e){if(e){var t=s.parseGroupBy(e);return l.spec(this._spec,t.include,t.replacer)}return l.spec(this._spec)},e.prototype._encoding=function(){for(var e={},t=0,n=this._spec.encodings;t<n.length;t++){var a=n[t],u={};if(c.isFieldQuery(a)&&a.autoCount===!0)u.aggregate="count",u.field="*",u.type=r.Type.QUANTITATIVE;else if(c.isValueQuery(a)||a.autoCount===!1)continue;if(o.isWildcard(a.channel))return null;for(var s=[i.Property.AGGREGATE,i.Property.BIN,i.Property.TIMEUNIT,i.Property.FIELD,i.Property.TYPE,i.Property.SCALE,i.Property.SORT,i.Property.AXIS,i.Property.LEGEND],d=0,f=s;d<f.length;d++){var p=f[d];if(o.isWildcard(a[p]))return null;void 0!==a[p]&&(l.PROPERTY_SUPPORTED_CHANNELS[p]&&!l.PROPERTY_SUPPORTED_CHANNELS[p][a.channel]||(u[p]=a[p]))}u.bin===!1&&delete u.bin,e[a.channel]=u}return e},e.prototype.toSpec=function(e){if(o.isWildcard(this._spec.mark))return null;var t={};return e=e||this._spec.data,e&&(t.data=e),this._spec.transform&&(t.transform=this._spec.transform),t.mark=this._spec.mark,t.encoding=this._encoding(),null===t.encoding?null:((this._spec.config||this._opt.defaultSpecConfig)&&(t.config=d.extend({},this._opt.defaultSpecConfig,this._spec.config)),t)},e.prototype.getRankingScore=function(e){return this._rankingScore[e]},e.prototype.setRankingScore=function(e,t){this._rankingScore[e]=t},e}();n.SpecQueryModel=f;var p=function(){function e(e,t,n,r,i){void 0===e&&(e=""),void 0===t&&(t=""),void 0===n&&(n=[]),void 0===r&&(r=void 0),void 0===i&&(i=void 0),this._name=e,this._path=t,this._items=n,this._groupBy=r,this._orderGroupBy=i}return e.prototype.getTopSpecQueryModel=function(){var t=this._items[0];return t instanceof e?t.getTopSpecQueryModel():t},Object.defineProperty(e.prototype,"name",{get:function(){return this._name},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"items",{get:function(){return this._items},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"groupBy",{get:function(){return this._groupBy},set:function(e){this._groupBy=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"orderGroupBy",{get:function(){return this._orderGroupBy},set:function(e){this._orderGroupBy=e},enumerable:!0,configurable:!0}),e}();n.SpecQueryModelGroup=p},{"./property":11,"./query/encoding":13,"./query/groupby":14,"./query/shorthand":17,"./query/spec":18,"./util":35,"./wildcard":36,"./wildcardindex":37,"vega-lite/build/src/type":62}],10:[function(e,t,n){"use strict";function r(e,t){y[e]=t}function i(e,t){if(t){for(var n=new c.SpecQueryModelGroup,r={},i=[],o=[],a=[],s=0;s<t.length;s++){i.push(s>0?i[s-1].duplicate():new l.PropIndex),o.push(s>0?o[s-1].duplicate():new l.PropIndex);var p=t[s].groupBy;if(u.isArray(p)){var g=d.parseGroupBy(p,i[s],o[s]);a.push(g.replacer)}}return e.forEach(function(e){for(var o="",s=n,l=0;l<t.length;l++){var d=s.groupBy=t[l].groupBy;s.orderGroupBy=t[l].orderGroupBy;var p=u.isArray(d)?f.spec(e.specQuery,i[l],a[l]):y[d](e);o+="/"+p,r[o]||(r[o]=new c.SpecQueryModelGroup(p,o,[]),s.items.push(r[o])),s=r[o]}s.items.push(e)}),n}return new c.SpecQueryModelGroup("","",e)}function o(e){var t=p.stack(e.specQuery);return t?"stack="+t.offset+"|":""}var a=e("vega-lite/build/src/channel"),u=e("datalib/src/util"),c=e("./model"),s=e("./property"),l=e("./propindex"),d=e("./query/groupby"),f=e("./query/shorthand"),p=e("./query/spec"),y={};n.registerKeyFn=r,n.FIELD="field",n.FIELD_TRANSFORM="fieldTransform",n.ENCODING="encoding",n.TRANSPOSE="transpose",n.SPEC="spec",n.nest=i;var g=[s.Property.FIELD],h=d.parseGroupBy(g);r(n.FIELD,function(e){return f.spec(e.specQuery,h.include,h.replacer)}),n.PARSED_GROUP_BY_FIELD_TRANSFORM=d.parseGroupBy(d.GROUP_BY_FIELD_TRANSFORM),r(n.FIELD_TRANSFORM,function(e){return f.spec(e.specQuery,n.PARSED_GROUP_BY_FIELD_TRANSFORM.include,n.PARSED_GROUP_BY_FIELD_TRANSFORM.replacer)}),n.PARSED_GROUP_BY_ENCODING=d.parseGroupBy(d.GROUP_BY_ENCODING),r(n.ENCODING,function(e){return f.spec(e.specQuery,n.PARSED_GROUP_BY_ENCODING.include,n.PARSED_GROUP_BY_ENCODING.replacer)}),r(n.TRANSPOSE,function(e){return e.getMark()+"|"+o(e)+e.getEncodings().map(function(e){var t=f.fieldDef(e),n=e.channel===a.Channel.X||e.channel===a.Channel.Y?"xy":e.channel===a.Channel.ROW||e.channel===a.Channel.COLUMN?"facet":e.channel;return n+":"+t}).sort().join("|")}),r(n.SPEC,function(e){return JSON.stringify(e.specQuery)})},{"./model":9,"./property":11,"./propindex":12,"./query/groupby":14,"./query/shorthand":17,"./query/spec":18,"datalib/src/util":45,"vega-lite/build/src/channel":53}],11:[function(e,t,n){"use strict";function r(e){return!!e.parent}function i(e){return e in y}function o(e){return h[e]}function a(e){return r(e)?e.parent+T+e.child:e}function u(e){var t=e.split(T);if(1===t.length)return e;if(2===t.length)return{parent:t[0],child:t[1]};throw"Invalid property key with "+t.length+" dots: "+e}function c(e,t){return(N[e]||{})[t]}function s(e){return i(e)||r(e)}var l=e("vega-lite/build/src/axis"),d=e("vega-lite/build/src/scale"),f=e("vega-lite/build/src/legend"),p=e("./util");n.isEncodingNestedProp=r,n.ENCODING_TOPLEVEL_PROPS=["channel","aggregate","autoCount","bin","timeUnit","hasFn","sort","field","type","scale","axis","legend"];var y=p.toMap(n.ENCODING_TOPLEVEL_PROPS);n.isEncodingTopLevelProperty=i;var g=["bin","scale","sort","axis","legend"],h=p.toMap(g);n.hasNestedProperty=o,n.BIN_CHILD_PROPS=["maxbins","divide","extent","base","step","steps","minstep"],n.SORT_CHILD_PROPS=["field","op","order"],n.SCALE_CHILD_PROPS=["clamp","domain","exponent","nice","range","rangeStep","round","type","zero"];var m=n.BIN_CHILD_PROPS.map(function(e){return{parent:"bin",child:e}});n.SORT_PROPS=n.SORT_CHILD_PROPS.map(function(e){return{parent:"sort",child:e}}),n.SCALE_PROPS=d.SCALE_PROPERTIES.map(function(e){return{parent:"scale",child:e}});var v=l.AXIS_PROPERTIES.map(function(e){return{parent:"axis",child:e}}),E=f.LEGEND_PROPERTIES.map(function(e){return{parent:"legend",child:e}});n.ENCODING_NESTED_PROPS=[].concat(m,n.SORT_PROPS,n.SCALE_PROPS,v,E);var T=".";n.toKey=a,n.fromKey=u;var N=n.ENCODING_NESTED_PROPS.reduce(function(e,t){return e[t.parent]=e[t.parent]||[],e[t.parent][t.child]=t,e},{});n.getEncodingNestedProp=c,n.isEncodingProperty=s,n.ALL_ENCODING_PROPS=[].concat(n.ENCODING_TOPLEVEL_PROPS,n.ENCODING_NESTED_PROPS),n.DEFAULT_PROP_PRECEDENCE=["type","field","bin","timeUnit","aggregate","autoCount","channel","mark","scale","sort","axis","legend"].concat(m,n.SCALE_PROPS,v,E,n.SORT_PROPS);var S;!function(e){e.MARK="mark",e.FILTER="filter",e.CALCULATE="calculate",e.FILTERINVALID="filterInvalid",e.STACK="stack",e.CHANNEL="channel",e.AGGREGATE="aggregate",e.AUTOCOUNT="autoCount",e.BIN="bin",e.HAS_FN="hasFn",e.TIMEUNIT="timeUnit",e.FIELD="field",e.TYPE="type",e.SORT="sort",e.SCALE="scale",e.AXIS="axis",e.LEGEND="legend"}(S=n.Property||(n.Property={}))},{"./util":35,"vega-lite/build/src/axis":51,"vega-lite/build/src/legend":57,"vega-lite/build/src/scale":60}],12:[function(e,t,n){"use strict";var r=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e},i=e("./util"),o=e("./property"),a=function(){function e(e){void 0===e&&(e=null),this.index=e?r({},e):{}}return e.prototype.has=function(e){return o.toKey(e)in this.index},e.prototype.get=function(e){return this.index[o.toKey(e)]},e.prototype.set=function(e,t){return this.index[o.toKey(e)]=t,this},e.prototype.setByKey=function(e,t){this.index[e]=t},e.prototype.map=function(t){var n=new e;for(var r in this.index)n.index[r]=t(this.index[r]);return n},e.prototype.size=function(){return i.keys(this.index).length},e.prototype.duplicate=function(){return new e(this.index)},e}();n.PropIndex=a},{"./property":11,"./util":35}],13:[function(e,t,n){"use strict";function r(e){return null!==e&&void 0!==e&&e.value}function i(e){return null!==e&&void 0!==e&&(e.field||"autoCount"in e)}function o(e,t){return void 0===t&&(t=["aggregate","autoCount","bin","timeUnit","field","type"]),t.reduce(function(t,n){if(d.isWildcard(e[n]))throw new Error("Cannot convert "+JSON.stringify(e)+" to fielddef: "+n+" is wildcard");if(void 0!==e[n])if("autoCount"===n){if(!e[n])throw new Error("Cannot convert {autoCount: false} into a field def");t.aggregate="count"}else t[n]=e[n];return t},{})}function a(e){return s.isContinuous(o(e,["bin","timeUnit","field","type"]))}function u(e){return s.isDiscrete(o(e,["bin","timeUnit","field","type"]))}function c(e){var t=e.scale===!0||e.scale===d.SHORT_WILDCARD?{}:e.scale||{},n=e.type,r=e.channel,i=e.timeUnit,o=e.bin,a=void 0,u=!1,c={};if(!(d.isWildcard(t.type)||d.isWildcard(n)||d.isWildcard(r)||d.isWildcard(o))){var s=void 0;if(!("temporal"===n&&d.isWildcard(i)||"quantitative"===n&&d.isWildcard(o)))return l["default"](t.type,r,{type:n,timeUnit:i,bin:o},a,u,s,c)}}var s=e("vega-lite/build/src/fielddef"),l=e("vega-lite/build/src/compile/scale/type"),d=e("../wildcard");n.isValueQuery=r,n.isFieldQuery=i,n.toFieldDef=o,n.isContinuous=a,n.isDiscrete=u,n.scaleType=c},{"../wildcard":36,"vega-lite/build/src/compile/scale/type":54,"vega-lite/build/src/fielddef":56}],14:[function(e,t,n){"use strict";function r(e){return a.isObject(e)&&!!e.property}function i(e,t,n){return t=t||new s.PropIndex,n=n||new s.PropIndex,e.forEach(function(e){r(e)?(t.setByKey(e.property,!0),n.setByKey(e.property,e.replace)):t.setByKey(e,!0)}),{include:t,replaceIndex:n,replacer:u.getReplacerIndex(n)}}function o(e){return a.isArray(e)?e.map(function(e){if(r(e)){if(e.replace){var t=l.keys(e.replace).reduce(function(t,n){var r=e.replace[n];return(t[r]=t[r]||[]).push(n),t},{});return e.property+"["+l.keys(t).map(function(e){var n=t[e].sort();return n.join(",")+"=>"+e}).join(";")+"]"}return e.property}return e}).join(","):e}var a=e("datalib/src/util"),u=e("./shorthand"),c=e("../property"),s=e("../propindex"),l=e("../util");n.REPLACE_BLANK_FIELDS={"*":""},n.REPLACE_XY_CHANNELS={x:"xy",y:"xy"},n.REPLACE_FACET_CHANNELS={row:"facet",column:"facet"},n.REPLACE_MARK_STYLE_CHANNELS={color:"style",opacity:"style",shape:"style",size:"style"},n.isExtendedGroupBy=r,n.parseGroupBy=i,n.toString=o,n.GROUP_BY_FIELD_TRANSFORM=[c.Property.FIELD,c.Property.TYPE,c.Property.AGGREGATE,c.Property.BIN,c.Property.TIMEUNIT,c.Property.STACK],n.GROUP_BY_ENCODING=n.GROUP_BY_FIELD_TRANSFORM.concat([{property:c.Property.CHANNEL,replace:{x:"xy",y:"xy",color:"style",size:"style",shape:"style",opacity:"style",row:"facet",column:"facet"}}])},{"../property":11,"../propindex":12,"../util":35,"./shorthand":17,"datalib/src/util":45}],15:[function(e,t,n){"use strict";n.encoding=e("./encoding");var r=e("./normalize");n.normalize=r.normalize,n.groupBy=e("./groupby"),n.shorthand=e("./shorthand"),n.spec=e("./spec"),n.transform=e("./transform")},{"./encoding":13,"./groupby":14,"./normalize":16,"./shorthand":17,"./spec":18,"./transform":19}],16:[function(e,t,n){"use strict";function r(e){if(e.groupBy){var t={groupBy:e.groupBy};e.orderBy&&(t.orderGroupBy=e.orderBy);var n={spec:i.duplicate(e.spec),nest:[t]};return e.chooseBy&&(n.chooseBy=e.chooseBy),e.config&&(n.config=e.config),n}return i.duplicate(e)}var i=e("../util");n.normalize=r},{"../util":35}],17:[function(e,t,n){"use strict";function r(e){return e.map(function(e){return i(e)})}function i(e){return function(t){return void 0!==e[t]?e[t]:t}}function o(e,t){return A.isWildcard(e)?!A.isShortWildcard(e)&&e["enum"]?A.SHORT_WILDCARD+JSON.stringify(e["enum"]):A.SHORT_WILDCARD:t?t(e):e}function a(e,t){return t?t(e):e}function u(e,t,r){void 0===t&&(t=n.INCLUDE_ALL),void 0===r&&(r=n.REPLACE_NONE);var i=S.fromSpec(e);return c(i,t,r)}function c(e,t,r){void 0===t&&(t=n.INCLUDE_ALL),void 0===r&&(r=n.REPLACE_NONE);var i=[];if(t.get(O.Property.MARK)&&i.push(o(e.mark,r.get(O.Property.MARK))),e.transform&&(t.get(O.Property.CALCULATE)&&void 0!==e.transform.calculate&&i.push("calculate:"+s(e.transform.calculate)),t.get(O.Property.FILTER)&&void 0!==e.transform.filter&&i.push("filter:"+JSON.stringify(e.transform.filter)),t.get(O.Property.FILTERINVALID)&&void 0!==e.transform.filterInvalid&&i.push("filterInvalid:"+e.transform.filterInvalid)),t.get(O.Property.STACK)){var a=S.stack(e);if(a){var u=t.duplicate().set("type",!1),c=d(a.fieldEncQ,u,r),f=d(a.groupByEncQ,u,r);i.push("stack={field:"+c+","+(f?"by:"+f+",":"")+"offset:"+a.offset+"}")}}if(e.encodings){var p=e.encodings.reduce(function(e,n){if(N.isFieldQuery(n)&&n.autoCount!==!1){var i=l(n,t,r);i&&e.push(i)}return e},[]).sort().join("|");p&&i.push(p)}return i.join("|")}function s(e){return JSON.stringify(e.reduce(function(e,t){return e[t.as]=t.expr,e},{}))}function l(e,t,r){void 0===t&&(t=n.INCLUDE_ALL),void 0===r&&(r=n.REPLACE_NONE);var i=[];if(t.get(O.Property.CHANNEL)&&i.push(o(e.channel,r.get(O.Property.CHANNEL))),N.isFieldQuery(e)){var a=d(e,t,r);a&&i.push(a)}else N.isValueQuery(e)&&i.push(e.value);return i.join(":")}function d(e,t,r){if(void 0===t&&(t=n.INCLUDE_ALL),void 0===r&&(r=n.REPLACE_NONE),t.get(O.Property.AGGREGATE)&&e.autoCount===!1)return"-";var i=f(e,t,r),a=p(e,t,r),u=t.get("field")?o(e.field||"*",r.get("field")):"...";if(t.get(O.Property.TYPE))if(A.isWildcard(e.type))u+=","+o(e.type,r.get(O.Property.TYPE));else{var c=((e.type||E.Type.QUANTITATIVE)+"").substr(0,1);u+=","+o(c,r.get(O.Property.TYPE))}if(u+=a.map(function(e){var t=e.value instanceof Array?"["+e.value+"]":e.value;return","+e.key+"="+t}).join(""),i){var s=T.isString(i)?i:A.SHORT_WILDCARD+(P.keys(i).length>0?JSON.stringify(i):"");return s+"("+u+")"}return u}function f(e,t,n){if(t.get(O.Property.AGGREGATE)&&e.aggregate&&!A.isWildcard(e.aggregate))return a(e.aggregate,n.get(O.Property.AGGREGATE));if(t.get(O.Property.AGGREGATE)&&e.autoCount&&!A.isWildcard(e.autoCount))return a("count",n.get(O.Property.AGGREGATE));if(t.get(O.Property.TIMEUNIT)&&e.timeUnit&&!A.isWildcard(e.timeUnit))return a(e.timeUnit,n.get(O.Property.TIMEUNIT));if(t.get(O.Property.BIN)&&e.bin&&!A.isWildcard(e.bin))return"bin";for(var r=null,i=0,o=[O.Property.AGGREGATE,O.Property.AUTOCOUNT,O.Property.TIMEUNIT,O.Property.BIN];i<o.length;i++){var u=o[i],c=e[u];t.get(u)&&e[u]&&A.isWildcard(c)&&(r=r||{},r[u]=A.isShortWildcard(c)?c:c["enum"])}return r&&e.hasFn&&(r.hasFn=!0),r}function p(e,t,r){var i=[];if(!P.isBoolean(e.bin)&&!A.isShortWildcard(e.bin)){var u=e.bin;for(var c in u){var s=O.getEncodingNestedProp("bin",c);s&&t.get(s)&&void 0!==u[c]&&i.push({key:c,value:o(u[c],r.get(s))})}i.sort(function(e,t){return e.key.localeCompare(t.key)})}for(var l=0,d=[O.Property.SCALE,O.Property.SORT,O.Property.AXIS,O.Property.LEGEND];l<d.length;l++){var f=d[l];if((A.isWildcard(e.channel)||n.PROPERTY_SUPPORTED_CHANNELS[f][e.channel])&&t.get(f)&&void 0!==e[f]){var p=e[f];if(P.isBoolean(p)||null===p)i.push({key:f+"",value:p||!1});else if(T.isString(p))i.push({key:f+"",value:a(JSON.stringify(p),r.get(f))});else{var y=[];for(var c in p){var g=O.getEncodingNestedProp(f,c);g&&t.get(g)&&void 0!==p[c]&&y.push({key:c,value:o(p[c],r.get(g))})}if(y.length>0){var h=y.sort(function(e,t){return e.key.localeCompare(t.key)}).reduce(function(e,t){return e[t.key]=t.value,e},{});i.push({key:f+"",value:JSON.stringify(h)})}}}}return i}function y(e){for(var t=e.split("|"),n={mark:t[0],encodings:[]},r=1;r<t.length;r++){var i=t[r],o=g(i,":",1),a=o[0],u=o[1];if(I[a]||"?"===a){var c=_.encoding(a,u);n.encodings.push(c)}else if("calculate"!==a)"filter"!==a?"filterInvalid"!==a||(n.transform=n.transform||{},n.transform.filterInvalid=JSON.parse(u)):(n.transform=n.transform||{},n.transform.filter=JSON.parse(u));else{n.transform=n.transform||{};var s=[],l=JSON.parse(u);for(var d in l)s.push({expr:l[d],as:d});n.transform.calculate=s}}return n}function g(e,t,n){for(var r=[],i=0,o=0;o<n;o++){var a=e.indexOf(t,i);if(a===-1)break;r.push(e.substring(i,a)),i=a+1}if(r.push(e.substr(i)),r.length!==n+1)for(;r.length!==n+1;)r.push("");return r}var h=e("vega-lite/build/src/aggregate"),m=e("vega-lite/build/src/channel"),v=e("vega-lite/build/src/timeunit"),E=e("vega-lite/build/src/type"),T=e("datalib/src/util"),N=e("./encoding"),S=e("./spec"),A=e("../wildcard"),O=e("../property"),C=e("../propindex"),P=e("../util");n.getReplacerIndex=r,n.getReplacer=i,n.value=o,n.replace=a,n.REPLACE_NONE=new C.PropIndex,n.INCLUDE_ALL=O.DEFAULT_PROP_PRECEDENCE.concat(O.SORT_PROPS,[O.Property.CALCULATE,O.Property.FILTER,O.Property.FILTERINVALID,O.Property.STACK]).reduce(function(e,t){return e.set(t,!0)},new C.PropIndex),n.vlSpec=u,n.PROPERTY_SUPPORTED_CHANNELS={axis:{x:!0,y:!0,row:!0,column:!0},legend:{color:!0,opacity:!0,size:!0,shape:!0},scale:{x:!0,y:!0,color:!0,opacity:!0,row:!0,column:!0,size:!0,shape:!0},sort:{x:!0,y:!0,path:!0,order:!0}},n.spec=c,n.calculate=s,n.encoding=l,n.fieldDef=d;var I=T.toMap(m.CHANNELS),b=T.toMap(h.AGGREGATE_OPS),R=T.toMap(v.SINGLE_TIMEUNITS),M=T.toMap(v.MULTI_TIMEUNITS);n.parse=y,n.splitWithTail=g;var _;!function(e){function t(e,t){var r={channel:e};return r=t.indexOf("(")!==-1?i(r,t):n(r,g(t,",",2))}function n(e,t){e.field=t[0],e.type=E.getFullName(t[1].toUpperCase())||"?";for(var n=t[2],i=0,o=0;o<n.length;){var a=n.indexOf("=",o),u=void 0;if(a===-1)break;var c=n.substring(o,a);if("{"===n[o+c.length+1]){var s=o+c.length+1;i=r(s,n,"}");var l=n.substring(s,i+1);u=JSON.parse(l),o=i+2}else if("["===n[o+c.length+1]){var d=o+c.length+1,f=r(d,n,"]"),p=n.substring(d,f+1);u=JSON.parse(p),o=f+2}else{var y=o,g=n.indexOf(",",o+c.length);g===-1&&(g=n.length),o=g+1,u=JSON.parse(n.substring(y+c.length+1,g))}O.hasNestedProperty(c)?e[c]=u:e.bin[c]=u}return e}function r(e,t,n){for(var r=e;r<t.length;r++)if(t[r]===n)return r}function i(e,t){if("?"===t[0]){var i=r(1,t,"}"),o=JSON.parse(t.substring(1,i+1));for(var a in o)P.isArray(o[a])?e[a]={"enum":o[a]}:e[a]=o[a];return n(e,g(t.substring(i+2,t.length-1),",",2))}var u=t.substring(0,t.indexOf("(")),c=t.substring(u.length+1,t.length-1),s=g(c,",",2);return b[u]?(e.aggregate=u,n(e,s)):M[u]||R[u]?(e.timeUnit=u,n(e,s)):"bin"===u?(e.bin={},n(e,s)):void 0}e.encoding=t,e.rawFieldDef=n,e.getClosingIndex=r,e.fn=i}(_=n.shorthandParser||(n.shorthandParser={}))},{"../property":11,"../propindex":12,"../util":35,"../wildcard":36,"./encoding":13,"./spec":18,"datalib/src/util":45,"vega-lite/build/src/aggregate":50,"vega-lite/build/src/channel":53,"vega-lite/build/src/timeunit":61,"vega-lite/build/src/type":62}],18:[function(e,t,n){"use strict";function r(e){return s.extend(e.data?{data:e.data}:{},e.transform?{transform:e.transform}:{},{mark:e.mark,encodings:s.keys(e.encoding).map(function(t){var n={channel:t},r=e.encoding[t];for(var i in r)c.isEncodingTopLevelProperty(i)&&void 0!==r[i]&&(s.contains(["bin","scale","axis","legend"],i)&&null===r[i]?n[i]=!1:n[i]=r[i]);return n})},e.config?{config:e.config}:{})}function i(e){return s.some(e.encodings,function(e){return l.isFieldQuery(e)&&(!u.isWildcard(e.aggregate)&&!!e.aggregate||e.autoCount===!0)})}function o(e){var t=e.config,n=t?t.stack:void 0;if(s.contains(["none",null,!1],n))return null;if(!s.contains(["bar","area"],e.mark))return null;if(!i(e))return null;var r=e.encodings.reduce(function(e,t){return!s.contains(a.STACK_GROUP_CHANNELS,t.channel)||!l.isValueQuery(t)&&t.aggregate||e.push({channel:t.channel,fieldDef:t}),e},[]);if(0===r.length)return null;var o=e.encodings.reduce(function(e,t){return e||(t.channel===a.Channel.X?t:null)},null),u=e.encodings.reduce(function(e,t){return e||(t.channel===a.Channel.Y?t:null)},null),c=l.isFieldQuery(o)&&(!!o.aggregate||!!o.autoCount),d=l.isFieldQuery(u)&&(!!u.aggregate||!!u.autoCount);return c!==d?{groupbyChannel:c?u?a.Y:null:o?a.X:null,groupByEncQ:c?u:o,fieldChannel:c?a.X:a.Y,fieldEncQ:c?o:u,stackBy:r,offset:n||"zero"}:null}var a=e("vega-lite/build/src/channel"),u=e("../wildcard"),c=e("../property"),s=e("../util"),l=e("./encoding");n.fromSpec=r,n.isAggregate=i,n.stack=o},{"../property":11,"../util":35,"../wildcard":36,"./encoding":13,"vega-lite/build/src/channel":53}],19:[function(e,t,n){"use strict"},{}],20:[function(e,t,n){"use strict";function r(e,t,n){var r=o(e,t,n);return{score:r.score,features:[r]}}function i(e){return c.isDiscrete(e)||!!e.timeUnit}function o(e,t,r){var o=e.getEncodings();if(e.isAggregate()){var s=function(e){return c.isFieldQuery(e)&&(e.type===a.Type.QUANTITATIVE&&!e.bin&&!e.aggregate&&!e.autoCount||e.type===a.Type.TEMPORAL&&!e.timeUnit)};if(u.some(o,s))return{type:n.name,score:.1,feature:"Aggregate with raw continuous"};if(u.some(o,function(e){return c.isFieldQuery(e)&&i(e)})){var l=u.some(o,function(e){return c.isFieldQuery(e)&&("count"===e.aggregate||e.autoCount===!0)}),d=u.some(o,function(e){return c.isFieldQuery(e)&&!!e.bin});return l?{type:n.name,score:.8,feature:"Aggregate with count"}:d?{type:n.name,score:.7,feature:"Aggregate with bin but without count"}:{type:n.name,score:.9,feature:"Aggregate without count and without bin"}}return{type:n.name,score:.3,feature:"Aggregate without dimension"}}return u.some(o,function(e){return c.isFieldQuery(e)&&!i(e)})?{type:n.name,score:1,feature:"Raw with measure"}:{type:n.name,score:.2,feature:"Raw without measure"}}var a=e("vega-lite/build/src/type"),u=e("../util"),c=e("../query/encoding");n.name="aggregationQuality",n.score=r},{"../query/encoding":13,"../util":35,"vega-lite/build/src/type":62}],21:[function(e,t,n){"use strict";var r=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},i=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e},o=e("vega-lite/build/src/channel"),a=e("../../config"),u=e("./type"),c=e("./base"),s=function(e){function t(){return e.call(this,"Axis")||this}return r(t,e),t.prototype.initScore=function(e){void 0===e&&(e={}),e=i({},a.DEFAULT_QUERY_CONFIG,e);var t={},n=[{feature:u.BIN_Q,opt:"preferredBinAxis"},{feature:u.T,opt:"preferredTemporalAxis"},{feature:u.TIMEUNIT_T,opt:"preferredTemporalAxis"},{feature:u.TIMEUNIT_O,opt:"preferredTemporalAxis"},{feature:u.O,opt:"preferredOrdinalAxis"},{feature:u.N,opt:"preferredNominalAxis"}];return n.forEach(function(n){e[n.opt]===o.Channel.X?t[n.feature+"_"+o.Channel.Y]=-.01:e[n.opt]===o.Channel.Y&&(t[n.feature+"_"+o.Channel.X]=-.01)}),t},t.prototype.featurize=function(e,t){return e+"_"+t},t.prototype.getScore=function(e,t,n){var r=this;return e.getEncodings().reduce(function(e,t){var n=u.getExtendedType(t),i=r.featurize(n,t.channel),o=r.getFeatureScore(i);return o&&e.push(o),e},[])},t}(c.Scorer);n.AxisScorer=s},{"../../config":1,"./base":22,"./type":28,"vega-lite/build/src/channel":53}],22:[function(e,t,n){"use strict";var r=function(){function e(e){this.type=e,this.scoreIndex=this.initScore()}return e.prototype.getFeatureScore=function(e){var t=this.type,n=this.scoreIndex[e];if(void 0!==n)return{type:t,feature:e,score:n}},e}();n.Scorer=r},{}],23:[function(e,t,n){"use strict";var r=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},i=e("./base"),o=e("../../query/encoding"),a=function(e){function t(){return e.call(this,"Dimension")||this}return r(t,e),t.prototype.initScore=function(){return{row:-2,column:-2,color:0,opacity:0,size:0,shape:0}},t.prototype.getScore=function(e,t,n){var r=this;return e.isAggregate()&&e.getEncodings().reduce(function(e,t){if(o.isFieldQuery(t)&&!t.aggregate&&!t.autoCount){var n=r.getFeatureScore(t.channel+"");if(n&&n.score>e.score)return n}return e},{type:"Dimension",feature:"No Dimension",score:-5}),[]},t}(i.Scorer);n.DimensionScorer=a},{"../../query/encoding":13,"./base":22}],24:[function(e,t,n){"use strict";var r=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},i=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e},o=e("./base"),a=e("../../config"),u=e("vega-lite/build/src/channel"),c=function(e){function t(){return e.call(this,"Facet")||this}return r(t,e),t.prototype.initScore=function(e){e=i({},a.DEFAULT_QUERY_CONFIG,e);var t={};return e.preferredFacet===u.Channel.ROW?t[u.Channel.COLUMN]=-.01:e.preferredFacet===u.Channel.COLUMN&&(t[u.Channel.ROW]=-.01),t},t.prototype.getScore=function(e,t,n){var r=this;return e.getEncodings().reduce(function(e,t){var n=r.getFeatureScore(t.channel);return n&&e.push(n),e},[])},t}(o.Scorer);n.FacetScorer=c},{"../../config":1,"./base":22,"vega-lite/build/src/channel":53}],25:[function(e,t,n){"use strict";function r(e,t,n){var r=l.reduce(function(r,i){var o=i.getScore(e,t,n);return r.concat(o)},[]);return{score:r.reduce(function(e,t){return e+t.score},0),features:r}}var i=e("./axis"),o=e("./dimension"),a=e("./facet"),u=e("./sizechannel"),c=e("./typechannel"),s=e("./mark"),l=[new i.AxisScorer,new o.DimensionScorer,new a.FacetScorer,new s.MarkScorer,new u.SizeChannelScorer,new c.TypeChannelScorer];n.effectiveness=r},{"./axis":21,"./dimension":23,"./facet":24,"./mark":26,"./sizechannel":27,"./typechannel":29}],26:[function(e,t,n){"use strict";function r(e,t,n,r){return e+"_"+t+"_"+n+"_"+r}function i(){var e=[s.Q,s.T],t=[s.BIN_Q,s.TIMEUNIT_O,s.O,s.N],n=t.concat([s.NONE]),i={};return e.forEach(function(t){e.forEach(function(e){var n={point:0,text:-.2,tick:-.5,rect:-1,bar:-2,line:-2,area:-2,rule:-2.5};c.forEach(n,function(n,o){var a=r(t,e,!0,o);i[a]=n});var o={point:0,text:-.2,tick:-.5,bar:-2,line:-2,area:-2,rule:-2.5};c.forEach(o,function(n,o){var a=r(t,e,!1,o);i[a]=n})})}),e.forEach(function(e){n.forEach(function(t){var n={tick:0,point:-.2,text:-.5,bar:-2,line:-2,area:-2,rule:-2.5};c.forEach(n,function(n,o){var a=r(e,t,!0,o);i[a]=n;var u=r(t,e,!0,o);i[u]=n})}),[s.TIMEUNIT_T].forEach(function(t){var n={point:0,text:-.5,tick:-1,bar:-2,line:-2,area:-2,rule:-2.5};c.forEach(n,function(n,o){var a=r(e,t,!0,o);i[a]=n;var u=r(t,e,!0,o);i[u]=n})}),[s.NONE,s.N,s.O].forEach(function(t){var n={bar:0,point:-.2,tick:-.25,text:-.3,line:-2,area:-2,rule:-2.5};c.forEach(n,function(n,o){var a=r(e,t,!1,o);i[a]=n;var u=r(t,e,!1,o);i[u]=n})}),[s.BIN_Q].forEach(function(t){var n={bar:0,point:-.2,tick:-.25,text:-.3,line:-.5,area:-.5,rule:-2.5};c.forEach(n,function(n,o){var a=r(e,t,!1,o);i[a]=n;var u=r(t,e,!1,o);i[u]=n})}),[s.TIMEUNIT_T,s.TIMEUNIT_O].forEach(function(t){var n={line:0,area:-.1,bar:-.2,point:-.3,tick:-.35,text:-.4,rule:-2.5};c.forEach(n,function(n,o){var a=r(e,t,!1,o);i[a]=n;var u=r(t,e,!1,o);i[u]=n})})}),[s.TIMEUNIT_T].forEach(function(e){[s.TIMEUNIT_T].forEach(function(t){var n={point:0,rect:-.1,text:-.5,tick:-1,bar:-2,line:-2,area:-2,rule:-2.5};c.forEach(n,function(n,o){var a=r(e,t,!0,o);i[a]=n}),c.forEach(n,function(n,o){var a=r(e,t,!1,o);i[a]=n})}),n.forEach(function(t){var n={tick:0,point:-.2,text:-.5,rect:-1,bar:-2,line:-2,area:-2,rule:-2.5};c.forEach(n,function(n,o){var a=r(e,t,!0,o);i[a]=n}),c.forEach(n,function(n,o){var a=r(t,e,!0,o);i[a]=n}),c.forEach(n,function(n,o){var a=r(e,t,!1,o);i[a]=n}),c.forEach(n,function(n,o){var a=r(t,e,!1,o);i[a]=n})})}),n.forEach(function(e){n.forEach(function(t){var n={point:0,rect:0,text:-.1,tick:-1,bar:-2,line:-2,area:-2,rule:-2.5};c.forEach(n,function(n,o){var a=r(e,t,!0,o);i[a]=n}),c.forEach(n,function(n,o){var a=r(e,t,!1,o);i[a]=n})})}),i}var o=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},a=e("vega-lite/build/src/channel"),u=e("vega-lite/build/src/mark"),c=e("../../util"),s=e("./type"),l=e("./base"),d=function(e){function t(){return e.call(this,"Mark")||this}return o(t,e),t.prototype.initScore=function(){return i()},t.prototype.getScore=function(e,t,n){var r=e.getMark();r!==u.Mark.CIRCLE&&r!==u.Mark.SQUARE||(r=u.Mark.POINT);var i=e.getEncodingQueryByChannel(a.Channel.X),o=i?s.getExtendedType(i):s.NONE,c=e.getEncodingQueryByChannel(a.Channel.Y),l=c?s.getExtendedType(c):s.NONE,d=!e.isAggregate(),f=o+"_"+l+"_"+d+"_"+r,p=this.getFeatureScore(f);return[p]},t}(l.Scorer);n.MarkScorer=d,n.featurize=r},{"../../util":35,"./base":22,"./type":28,"vega-lite/build/src/channel":53,"vega-lite/build/src/mark":59}],27:[function(e,t,n){"use strict";var r=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},i=e("./base"),o=function(e){function t(){return e.call(this,"SizeChannel")||this}return r(t,e),t.prototype.initScore=function(){return{bar_size:-2,tick_size:-2}},t.prototype.getScore=function(e,t,n){var r=this,i=e.getMark();return e.getEncodings().reduce(function(e,t){var n=i+"_"+t.channel,o=r.getFeatureScore(n);return o&&e.push(o),e},[])},t}(i.Scorer);n.SizeChannelScorer=o},{"./base":22}],28:[function(e,t,n){"use strict";function r(e){if(e.bin)return i.BIN_Q;if(e.timeUnit){var t=u.scaleType(e);return o.hasDiscreteDomain(t)?i.TIMEUNIT_O:i.TIMEUNIT_T}return e.type}var i,o=e("vega-lite/build/src/scale"),a=e("vega-lite/build/src/type"),u=e("../../query/encoding");!function(e){e[e.Q=a.Type.QUANTITATIVE]="Q",e[e.BIN_Q="bin_"+a.Type.QUANTITATIVE]="BIN_Q",e[e.T=a.Type.TEMPORAL]="T",e[e.TIMEUNIT_T="timeUnit_time"]="TIMEUNIT_T",e[e.TIMEUNIT_O="timeUnit_"+a.Type.ORDINAL]="TIMEUNIT_O",e[e.O=a.Type.ORDINAL]="O",e[e.N=a.Type.NOMINAL]="N",e[e.NONE="-"]="NONE"}(i=n.ExtendedType||(n.ExtendedType={})),n.Q=i.Q,n.BIN_Q=i.BIN_Q,n.T=i.T,n.TIMEUNIT_T=i.TIMEUNIT_T,n.TIMEUNIT_O=i.TIMEUNIT_O,n.O=i.O,n.N=i.N,n.NONE=i.NONE,n.getExtendedType=r},{"../../query/encoding":13,"vega-lite/build/src/scale":60,"vega-lite/build/src/type":62}],29:[function(e,t,n){"use strict";var r=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},i=e("../../query/shorthand"),o=e("../../util"),a=e("./type"),u=e("./base");n.TERRIBLE=-10;var c=function(e){function t(){return e.call(this,"TypeChannel")||this}return r(t,e),t.prototype.initScore=function(){var e=this,t={},r={x:0,y:0,size:-.575,color:-.725,text:-2,opacity:-3,shape:n.TERRIBLE,row:n.TERRIBLE,column:n.TERRIBLE,detail:2*n.TERRIBLE};[a.Q,a.T,a.TIMEUNIT_T].forEach(function(n){o.keys(r).forEach(function(i){
t[e.featurize(n,i)]=r[i]})});var i=o.extend({},r,{row:-.75,column:-.75,shape:-3.1,text:-3.2,detail:-4});[a.BIN_Q,a.TIMEUNIT_O,a.O].forEach(function(n){o.keys(i).forEach(function(r){t[e.featurize(n,r)]=i[r]})});var u={x:0,y:0,color:-.6,shape:-.65,row:-.7,column:-.7,text:-.8,detail:-2,size:-3,opacity:-3.1};return o.keys(u).forEach(function(n){t[e.featurize(a.N,n)]=u[n]}),t},t.prototype.featurize=function(e,t){return e+"_"+t},t.prototype.getScore=function(e,t,n){var r=this,u=e.getEncodings().reduce(function(e,t){var n=i.fieldDef(t);return(e[n]=e[n]||[]).push(t),e},{}),c=[];return o.forEach(u,function(e){var t=e.reduce(function(e,t){var n=a.getExtendedType(t),i=r.featurize(n,t.channel),o=r.getFeatureScore(i);return null===e||o.score>e.score?o:e},null);c.push(t)}),c},t}(u.Scorer);n.TypeChannelScorer=c},{"../../query/shorthand":17,"../../util":35,"./base":22,"./type":28}],30:[function(e,t,n){"use strict";function r(e,t,n){var r=e.wildcardIndex.encodingIndicesByProperty.get("field");if(!r)return{score:0,features:[]};for(var o=e.specQuery.encodings,a=t.fieldSchemas.length,u=[],c=0,s=1,l=r.length-1;l>=0;l--){var d=r[l],f=o[d];if(!i.isValueQuery(f)){var p=f.field,y=e.wildcardIndex.encodings[d].get("field"),g=t.fieldSchema(p).index,h=-g*s;c+=h,u.push({score:h,type:"fieldOrder",feature:"field "+y.name+" is "+p+" (#"+g+" in the schema)"}),s*=a}}return{score:c,features:u}}var i=e("../query/encoding");n.name="fieldOrder",n.score=r},{"../query/encoding":13}],31:[function(e,t,n){"use strict";function r(e){for(var t in e)n.hasOwnProperty(t)||(n[t]=e[t])}function i(e,t){f[e]=t}function o(e){return f[e]}function a(e,t,n,r){return t.nest&&r!==t.nest.length?(e.items.forEach(function(e){a(e,t,n,r+1)}),t.nest[r].orderGroupBy&&e.items.sort(c(t.nest[r].orderGroupBy,n,t.config))):(t.orderBy||t.chooseBy)&&(e.items.sort(u(t.orderBy||t.chooseBy,n,t.config)),t.chooseBy&&e.items.length>0&&e.items.splice(1)),e}function u(e,t,n){return function(r,i){return e instanceof Array?s(e,r,i,t,n):s([e],r,i,t,n)}}function c(e,t,n){return function(r,i){var o=r.getTopSpecQueryModel(),a=i.getTopSpecQueryModel();return e instanceof Array?s(e,o,a,t,n):s([e],o,a,t,n)}}function s(e,t,n,r,i){for(var o=0,a=e;o<a.length;o++){var u=a[o],c=l(n,u,r,i).score-l(t,u,r,i).score;if(0!==c)return c}return 0}function l(e,t,n,r){if(void 0!==e.getRankingScore(t))return e.getRankingScore(t);var i=o(t),a=i(e,n,r);return e.setRankingScore(t,a),a}var d=e("./effectiveness");r(e("./effectiveness")),n.aggregation=e("./aggregation"),n.fieldOrder=e("./fieldorder");var f={};n.register=i,n.get=o,n.rank=a,n.comparatorFactory=u,n.groupComparatorFactory=c,n.getScore=l,n.EFFECTIVENESS="effectiveness",i(n.EFFECTIVENESS,d.effectiveness),i(n.aggregation.name,n.aggregation.score),i(n.fieldOrder.name,n.fieldOrder.score)},{"./aggregation":20,"./effectiveness":25,"./fieldorder":30}],32:[function(e,t,n){"use strict";function r(e,t,n){e=i({},c.normalize(e),{config:i({},o.DEFAULT_QUERY_CONFIG,n,e.config)});var r=a.generate(e.spec,t,e.config),l=u.nest(r,e.nest),d=s.rank(l,e,t,0);return{query:e,result:d}}var i=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e},o=e("./config"),a=e("./generate"),u=e("./nest"),c=e("./query/normalize"),s=e("./ranking/ranking");n.recommend=r},{"./config":1,"./generate":8,"./nest":10,"./query/normalize":16,"./ranking/ranking":31}],33:[function(e,t,n){"use strict";function r(e,t){void 0===t&&(t={}),t=g.extend({},y.DEFAULT_QUERY_CONFIG,t);var n=d.summary(e),r=f.inferAll(e),a=n.map(function(n){var i,o=n.field,a=r[o],u=n.distinct;if(a===m.NUMBER)i=c.Type.QUANTITATIVE;else if(a===m.INTEGER)i=u<t.numberNominalLimit&&u/n.count<t.numberNominalProportion?c.Type.NOMINAL:c.Type.QUANTITATIVE;else if(a===m.DATE){i=c.Type.TEMPORAL,n.min=new Date(e[0][o]),n.max=new Date(e[0][o]);for(var s=0,l=e;s<l.length;s++){var d=l[s],f=new Date(d[o]).getTime();f<n.min.getTime()&&(n.min=new Date(f)),f>n.max.getTime()&&(n.max=new Date(f))}}else i=c.Type.NOMINAL;return{field:o,type:i,primitiveType:a,stats:n,timeStats:{},binStats:{}}}),u={nominal:0,ordinal:1,temporal:2,quantitative:3};a.sort(function(e,t){return u[e.type]<u[t.type]?-1:u[e.type]>u[t.type]?1:e.field.localeCompare(t.field)}),a.forEach(function(e,t){return e.index=t});for(var s=0,l=a;s<l.length;s++){var p=l[s];if(p.type===c.Type.QUANTITATIVE)for(var v=0,E=t["enum"].binProps.maxbins;v<E.length;v++){var T=E[v];p.binStats[T]=i(T,p.stats)}else if(p.type===c.Type.TEMPORAL)for(var N=0,S=t["enum"].timeUnit;N<S.length;N++){var A=S[N];void 0!==A&&(p.timeStats[A]=o(A,p.stats))}}return new h(a)}function i(e,t){var n=p({min:t.min,max:t.max,maxbins:e}),r=g.extend({},t);return r.unique=a(n,t.unique),r.distinct=(n.stop-n.start)/n.step,r.min=n.start,r.max=n.stop,r}function o(e,t){var n=g.extend({},t),r={};return g.keys(t.unique).forEach(function(n){var i,o="null"===n?null:new Date(n);i=null===o?null:isNaN(o.getTime())?"Invalid Date":(e===l.TimeUnit.DAY?o.getDay():l.convert(e,o)).toString(),r[i]=(r[i]||0)+t.unique[n]}),n.unique=r,n.distinct=g.keys(r).length,n}function a(e,t){var n={};for(var r in t){var i=void 0;i=null===r?null:isNaN(Number(r))?NaN:e.value(Number(r)),n[i]=(n[i]||0)+t[r]}return n}function u(e,t){return t.reduce(function(t,n){return e[n]?t+1:t},0)}var c=e("vega-lite/build/src/type"),s=e("vega-lite/build/src/bin"),l=e("vega-lite/build/src/timeunit"),d=e("datalib/src/stats"),f=e("datalib/src/import/type"),p=e("datalib/src/bins/bins"),y=e("./config"),g=e("./util");n.build=r;var h=function(){function e(e){this._fieldSchemas=e,this._fieldSchemaIndex=e.reduce(function(e,t){return e[t.field]=t,e},{})}return e.prototype.fields=function(){return this._fieldSchemas.map(function(e){return e.field})},Object.defineProperty(e.prototype,"fieldSchemas",{get:function(){return this._fieldSchemas},enumerable:!0,configurable:!0}),e.prototype.fieldSchema=function(e){return this._fieldSchemaIndex[e]},e.prototype.primitiveType=function(e){return this._fieldSchemaIndex[e]?this._fieldSchemaIndex[e].primitiveType:null},e.prototype.type=function(e){return this._fieldSchemaIndex[e]?this._fieldSchemaIndex[e].type:null},e.prototype.cardinality=function(e,t,n){void 0===t&&(t=!0),void 0===n&&(n=!1);var r=this._fieldSchemaIndex[e.field];if(e.aggregate||e.autoCount)return 1;if(e.bin){var a=void 0;a="boolean"==typeof e.bin?{maxbins:s.autoMaxBins(e.channel)}:e.bin;var c=a.maxbins;return r.binStats[c]||(r.binStats[c]=i(c,r.stats)),r.binStats[c].distinct}if(e.timeUnit){if(t)switch(e.timeUnit){case l.TimeUnit.SECONDS:return 60;case l.TimeUnit.MINUTES:return 60;case l.TimeUnit.HOURS:return 24;case l.TimeUnit.DAY:return 7;case l.TimeUnit.DATE:return 31;case l.TimeUnit.MONTH:return 12;case l.TimeUnit.QUARTER:return 4;case l.TimeUnit.MILLISECONDS:return 1e3}var d=e.timeUnit,f=r.timeStats;return f[d]||(f[d]=o(e.timeUnit,r.stats)),n?f[d].distinct-u(f[d].unique,["Invalid Date",null]):f[d].distinct}return r?n?r.stats.distinct-u(r.stats.unique,[NaN,null]):r.stats.distinct:null},e.prototype.timeUnitHasVariation=function(e){if(e.timeUnit){if(e.timeUnit===l.TimeUnit.DAY){var t=g.extend({},e,{timeUnit:l.TimeUnit.DATE});if(this.cardinality(t,!1,!0)<=1)return!1}for(var n=e.timeUnit,r=0,i=l.SINGLE_TIMEUNITS;r<i.length;r++){var o=i[r];if(l.containsTimeUnit(n,o)){var a=g.extend({},e,{timeUnit:o});if(this.cardinality(a,!1,!0)<=1)return!1}}return!0}},e.prototype.domain=function(e){var t=this._fieldSchemaIndex[e.field],n=g.keys(t.stats.unique);return t.type===c.Type.QUANTITATIVE?[+t.stats.min,+t.stats.max]:t.primitiveType===m.DATE?[t.stats.min,t.stats.max]:t.primitiveType===m.INTEGER||t.primitiveType===m.NUMBER?(n=n.map(function(e){return+e}),n.sort(g.cmp)):n.map(function(e){return"null"===e?null:e}).sort(g.cmp)},e.prototype.stats=function(e){var t=this._fieldSchemaIndex[e.field];return t?t.stats:null},e}();n.Schema=h;var m;!function(e){e[e.STRING="string"]="STRING",e[e.NUMBER="number"]="NUMBER",e[e.INTEGER="integer"]="INTEGER",e[e.BOOLEAN="boolean"]="BOOLEAN",e[e.DATE="date"]="DATE"}(m=n.PrimitiveType||(n.PrimitiveType={}))},{"./config":1,"./util":35,"datalib/src/bins/bins":40,"datalib/src/import/type":42,"datalib/src/stats":43,"vega-lite/build/src/bin":52,"vega-lite/build/src/timeunit":61,"vega-lite/build/src/type":62}],34:[function(e,t,n){"use strict";function r(e,t,n){var r={};return e=e.map(function(e){return n.smallRangeStepForHighCardinalityOrFacet&&(e=i(e,t,r,n)),n.nominalColorScaleForHighCardinality&&(e=o(e,t,r,n)),n.xAxisOnTopForHighYCardinalityWithoutColumn&&(e=a(e,t,r,n)),e})}function i(e,t,n,r){[u.Channel.ROW,u.Channel.Y,u.Channel.COLUMN,u.Channel.X].forEach(function(t){n[t]=e.getEncodingQueryByChannel(t)});var i=n[u.Channel.Y];if(void 0!==i&&l.isFieldQuery(i)&&(n[u.Channel.ROW]||t.cardinality(i)>r.smallRangeStepForHighCardinalityOrFacet.maxCardinality)){void 0===i.scale&&(i.scale={});var o=l.scaleType(i);i.scale&&(void 0===o||c.hasDiscreteDomain(o))&&(i.scale.rangeStep||(i.scale.rangeStep=12))}var a=n[u.Channel.X];if(l.isFieldQuery(a)&&(n[u.Channel.COLUMN]||t.cardinality(a)>r.smallRangeStepForHighCardinalityOrFacet.maxCardinality)){void 0===a.scale&&(a.scale={});var s=l.scaleType(a);a.scale&&(void 0===s||c.hasDiscreteDomain(s))&&(a.scale.rangeStep||(a.scale.rangeStep=12))}return e}function o(e,t,n,r){n[u.Channel.COLOR]=e.getEncodingQueryByChannel(u.Channel.COLOR);var i=n[u.Channel.COLOR];return l.isFieldQuery(i)&&void 0!==i&&i.type===s.Type.NOMINAL&&t.cardinality(i)>r.nominalColorScaleForHighCardinality.maxCardinality&&(void 0===i.scale&&(i.scale={}),i.scale&&(i.scale.range||(i.scale.range=r.nominalColorScaleForHighCardinality.palette))),e}function a(e,t,n,r){if([u.Channel.COLUMN,u.Channel.X,u.Channel.Y].forEach(function(t){n[t]=e.getEncodingQueryByChannel(t)}),void 0===n[u.Channel.COLUMN]){var i=n[u.Channel.X],o=n[u.Channel.Y];l.isFieldQuery(i)&&l.isFieldQuery(o)&&void 0!==o&&o.field&&c.hasDiscreteDomain(l.scaleType(o))&&void 0!==i&&t.cardinality(o)>r.xAxisOnTopForHighYCardinalityWithoutColumn.maxCardinality&&(void 0===i.axis&&(i.axis={}),i.axis&&!i.axis.orient&&(i.axis.orient="top"))}return e}var u=e("vega-lite/build/src/channel"),c=e("vega-lite/build/src/scale"),s=e("vega-lite/build/src/type"),l=e("./query/encoding");n.stylize=r,n.smallRangeStepForHighCardinalityOrFacet=i,n.nominalColorScaleForHighCardinality=o,n.xAxisOnTopForHighYCardinalityWithoutColumn=a},{"./query/encoding":13,"vega-lite/build/src/channel":53,"vega-lite/build/src/scale":60,"vega-lite/build/src/type":62}],35:[function(e,t,n){"use strict";function r(e,t){return e.indexOf(t)!==-1}function i(e,t){for(var n=0;n<e.length;n++)if(!t(e[n],n))return!1;return!0}function o(e,t,n){if(e.forEach)e.forEach.call(n,t);else for(var r in e)t.call(n,e[r],r,e)}function a(e,t){var n,r=0;for(n in e)if(t(e[n],n,r++))return!0;return!1}function u(e,t){return e.map(function(e){return s.isArray(e)?u(e,t):t(e)})}function c(e,t){return e.filter(function(e){return!r(t,e)})}var s=e("datalib/src/util"),l=e("datalib/src/util");n.cmp=l.cmp,n.keys=l.keys,n.duplicate=l.duplicate,n.extend=l.extend,n.isObject=l.isObject,n.isArray=l.isArray,n.isBoolean=l.isBoolean,n.toMap=l.toMap,n.contains=r,n.every=i,n.forEach=o,n.some=a,n.nestedMap=u,n.without=c},{"datalib/src/util":45}],36:[function(e,t,n){"use strict";function r(e){return i(e)||o(e)}function i(e){return e===n.SHORT_WILDCARD}function o(e){return!(void 0===e||!e["enum"]&&!e.name||d.isArray(e))}function a(e,t,r){return d.extend({},{name:t,"enum":r},e===n.SHORT_WILDCARD?{}:e)}function u(e){for(var t={},n={},r=function(e){for(var r=[0],i=0;i<e.length;i++)e.charAt(i).toUpperCase()===e.charAt(i)&&r.push(i);var o=r.map(function(t){return e.charAt(t)}).join("").toLowerCase();if(!n[o])return t[e]=o,n[o]=!0,"continue";if(r[r.length-1]!==e.length-1&&(o=r.concat([e.length-1]).map(function(t){return e.charAt(t)}).join("").toLowerCase(),!n[o]))return t[e]=o,n[o]=!0,"continue";for(var i=1;!t[e];i++){var a=o+"_"+i;if(!n[a]){t[e]=a,n[a]=!0;break}}},i=0,o=e;i<o.length;i++){var a=o[i];r(a)}return t}function c(e){if(l.isEncodingNestedProp(e))return n.DEFAULT_NAME[e.parent]+"-"+n.DEFAULT_NAME[e.parent+"Props"][e.child];if(n.DEFAULT_NAME[e])return n.DEFAULT_NAME[e];throw new Error("Default name undefined for "+e)}function s(e,t,n){if("field"===e||l.isEncodingNestedProp(e)&&"sort"===e.parent&&"field"===e.child)return t.fields();var r;if(r=l.isEncodingNestedProp(e)?n["enum"][e.parent+"Props"][e.child]:n["enum"][e],void 0!==r)return r;throw new Error("No default enumValues for "+JSON.stringify(e))}var l=e("./property"),d=e("./util"),f=e("vega-lite/build/src/axis"),p=e("vega-lite/build/src/channel"),y=e("vega-lite/build/src/mark"),g=e("vega-lite/build/src/scale"),h=e("vega-lite/build/src/legend"),m=e("vega-lite/build/src/timeunit"),v=e("vega-lite/build/src/type");n.SHORT_WILDCARD="?",n.isWildcard=r,n.isShortWildcard=i,n.isWildcardDef=o,n.initWildcard=a,n.DEFAULT_NAME={mark:"m",channel:"c",aggregate:"a",autoCount:"#",hasFn:"h",bin:"b",sort:"so",scale:"s",axis:"ax",legend:"l",timeUnit:"tu",field:"f",type:"t",binProps:{maxbins:"mb",min:"mi",max:"ma",base:"b",step:"s",steps:"ss",minstep:"ms",divide:"d"},sortProps:{field:"f",op:"o",order:"or"},scaleProps:u(g.SCALE_PROPERTIES),axisProps:u(f.AXIS_PROPERTIES),legendProps:u(h.LEGEND_PROPERTIES)},n.getDefaultName=c;var E=[!1,!0],T={maxbins:[5,10,20],extent:[void 0],base:[10],step:[void 0],steps:[void 0],minstep:[void 0],divide:[[5,2]]},N={field:[void 0],op:["min","mean"],order:["ascending","descending"]},S={type:[void 0,g.ScaleType.LOG],domain:[void 0],exponent:[1,2],clamp:E,nice:E,round:E,zero:E,padding:[void 0],paddingInner:[void 0],paddingOuter:[void 0],interpolate:[void 0],range:[void 0],rangeStep:[17,21],scheme:[void 0]},A={zindex:[1,0],offset:[void 0],orient:[void 0],values:[void 0],domain:E,grid:E,format:[void 0],labels:E,labelAngle:[void 0],labelMaxLength:[void 0],labelPadding:[void 0],maxExtent:[void 0],minExtent:[void 0],position:[void 0],ticks:E,tickCount:[void 0],tickSize:[void 0],title:[void 0],titleMaxLength:[void 0],titlePadding:[void 0]},O={entryPadding:[void 0],orient:["left","right"],offset:[void 0],format:[void 0],values:[void 0],tickCount:[void 0],title:[void 0],type:[void 0],zindex:[void 0]};n.DEFAULT_ENUM_INDEX={mark:[y.Mark.POINT,y.Mark.BAR,y.Mark.LINE,y.Mark.AREA,y.Mark.TICK],channel:[p.X,p.Y,p.ROW,p.COLUMN,p.SIZE,p.COLOR],aggregate:[void 0,"mean"],autoCount:E,bin:E,hasFn:E,timeUnit:[void 0,m.TimeUnit.YEAR,m.TimeUnit.MONTH,m.TimeUnit.MINUTES,m.TimeUnit.SECONDS],field:[void 0],type:[v.Type.NOMINAL,v.Type.ORDINAL,v.Type.QUANTITATIVE,v.Type.TEMPORAL],sort:["ascending","descending"],scale:[!0],axis:E,legend:E,binProps:T,sortProps:N,scaleProps:S,axisProps:A,legendProps:O},n.getDefaultEnumValues=s},{"./property":11,"./util":35,"vega-lite/build/src/axis":51,"vega-lite/build/src/channel":53,"vega-lite/build/src/legend":57,"vega-lite/build/src/mark":59,"vega-lite/build/src/scale":60,"vega-lite/build/src/timeunit":61,"vega-lite/build/src/type":62}],37:[function(e,t,n){"use strict";var r=e("./property"),i=e("./propindex"),o=function(){function e(){this._mark=void 0,this._encodings={},this._encodingIndicesByProperty=new i.PropIndex}return e.prototype.setEncodingProperty=function(e,t,n){var r=this._encodings,o=r[e]=r[e]||new i.PropIndex;o.set(t,n);var a=this._encodingIndicesByProperty;return a.set(t,a.get(t)||[]),a.get(t).push(e),this},e.prototype.hasEncodingProperty=function(e,t){return!!this._encodings[e]&&this._encodings[e].has(t)},e.prototype.hasProperty=function(e){if(r.isEncodingProperty(e))return this.encodingIndicesByProperty.has(e);if("mark"===e)return!!this.mark;throw new Error("Unimplemented for property "+e)},e.prototype.isEmpty=function(){return!this.mark&&0===this.encodingIndicesByProperty.size()},e.prototype.setMark=function(e){return this._mark=e,this},Object.defineProperty(e.prototype,"mark",{get:function(){return this._mark},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"encodings",{get:function(){return this._encodings},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"encodingIndicesByProperty",{get:function(){return this._encodingIndicesByProperty},enumerable:!0,configurable:!0}),e}();n.WildcardIndex=o},{"./property":11,"./propindex":12}],38:[function(e,t,n){},{}],39:[function(t,n,r){!function(t,i){"object"==typeof r&&"undefined"!=typeof n?i(r):"function"==typeof e&&e.amd?e("d3-time",["exports"],i):i(t.d3_time={})}(this,function(e){"use strict";function t(e,n,r,a){function u(t){return e(t=new Date((+t))),t}return u.floor=u,u.round=function(t){var r=new Date((+t)),i=new Date(t-1);return e(r),e(i),n(i,1),t-r<i-t?r:i},u.ceil=function(t){return e(t=new Date(t-1)),n(t,1),t},u.offset=function(e,t){return n(e=new Date((+e)),null==t?1:Math.floor(t)),e},u.range=function(t,r,i){var o=[];if(t=new Date(t-1),r=new Date((+r)),i=null==i?1:Math.floor(i),!(t<r&&i>0))return o;for(n(t,1),e(t),t<r&&o.push(new Date((+t)));n(t,i),e(t),t<r;)o.push(new Date((+t)));return o},u.filter=function(r){return t(function(t){for(;e(t),!r(t);)t.setTime(t-1)},function(e,t){for(;--t>=0;)for(;n(e,1),!r(e););})},r&&(u.count=function(t,n){return i.setTime(+t),o.setTime(+n),e(i),e(o),Math.floor(r(i,o))},u.every=function(e){return e=Math.floor(e),isFinite(e)&&e>0?e>1?u.filter(a?function(t){return a(t)%e===0}:function(t){return u.count(0,t)%e===0}):u:null}),u}function n(e){return t(function(t){t.setHours(0,0,0,0),t.setDate(t.getDate()-(t.getDay()+7-e)%7)},function(e,t){e.setDate(e.getDate()+7*t)},function(e,t){return(t-e-6e4*(t.getTimezoneOffset()-e.getTimezoneOffset()))/6048e5})}function r(e){return t(function(t){t.setUTCHours(0,0,0,0),t.setUTCDate(t.getUTCDate()-(t.getUTCDay()+7-e)%7)},function(e,t){e.setUTCDate(e.getUTCDate()+7*t)},function(e,t){return(t-e)/6048e5})}var i=new Date,o=new Date,a=t(function(){},function(e,t){e.setTime(+e+t)},function(e,t){return t-e});a.every=function(e){return e=Math.floor(e),isFinite(e)&&e>0?e>1?t(function(t){t.setTime(Math.floor(t/e)*e)},function(t,n){t.setTime(+t+n*e)},function(t,n){return(n-t)/e}):a:null};var u=t(function(e){e.setMilliseconds(0)},function(e,t){e.setTime(+e+1e3*t)},function(e,t){return(t-e)/1e3},function(e){return e.getSeconds()}),c=t(function(e){e.setSeconds(0,0)},function(e,t){e.setTime(+e+6e4*t)},function(e,t){return(t-e)/6e4},function(e){return e.getMinutes()}),s=t(function(e){e.setMinutes(0,0,0)},function(e,t){e.setTime(+e+36e5*t)},function(e,t){return(t-e)/36e5},function(e){return e.getHours()}),l=t(function(e){e.setHours(0,0,0,0)},function(e,t){e.setDate(e.getDate()+t)},function(e,t){return(t-e-6e4*(t.getTimezoneOffset()-e.getTimezoneOffset()))/864e5},function(e){return e.getDate()-1}),d=n(0),f=n(1),p=n(2),y=n(3),g=n(4),h=n(5),m=n(6),v=t(function(e){e.setHours(0,0,0,0),e.setDate(1)},function(e,t){e.setMonth(e.getMonth()+t)},function(e,t){return t.getMonth()-e.getMonth()+12*(t.getFullYear()-e.getFullYear())},function(e){return e.getMonth()}),E=t(function(e){e.setHours(0,0,0,0),e.setMonth(0,1)},function(e,t){e.setFullYear(e.getFullYear()+t)},function(e,t){return t.getFullYear()-e.getFullYear()},function(e){return e.getFullYear()}),T=t(function(e){e.setUTCMilliseconds(0)},function(e,t){e.setTime(+e+1e3*t)},function(e,t){return(t-e)/1e3},function(e){return e.getUTCSeconds()}),N=t(function(e){e.setUTCSeconds(0,0)},function(e,t){e.setTime(+e+6e4*t)},function(e,t){return(t-e)/6e4},function(e){return e.getUTCMinutes()}),S=t(function(e){e.setUTCMinutes(0,0,0)},function(e,t){e.setTime(+e+36e5*t)},function(e,t){return(t-e)/36e5},function(e){return e.getUTCHours()}),A=t(function(e){e.setUTCHours(0,0,0,0)},function(e,t){e.setUTCDate(e.getUTCDate()+t)},function(e,t){return(t-e)/864e5},function(e){return e.getUTCDate()-1}),O=r(0),C=r(1),P=r(2),I=r(3),b=r(4),R=r(5),M=r(6),_=t(function(e){e.setUTCHours(0,0,0,0),e.setUTCDate(1)},function(e,t){e.setUTCMonth(e.getUTCMonth()+t)},function(e,t){return t.getUTCMonth()-e.getUTCMonth()+12*(t.getUTCFullYear()-e.getUTCFullYear())},function(e){return e.getUTCMonth()}),U=t(function(e){e.setUTCHours(0,0,0,0),e.setUTCMonth(0,1)},function(e,t){e.setUTCFullYear(e.getUTCFullYear()+t)},function(e,t){return t.getUTCFullYear()-e.getUTCFullYear()},function(e){return e.getUTCFullYear()}),D=a.range,L=u.range,w=c.range,x=s.range,F=l.range,k=d.range,H=f.range,W=p.range,B=y.range,G=g.range,Y=h.range,Q=m.range,q=d.range,j=v.range,V=E.range,z=a,X=D,$=T.range,K=N.range,J=S.range,Z=A.range,ee=O.range,te=C.range,ne=P.range,re=I.range,ie=b.range,oe=R.range,ae=M.range,ue=O.range,ce=_.range,se=U.range,le="0.1.1";e.version=le,e.milliseconds=D,e.seconds=L,e.minutes=w,e.hours=x,e.days=F,e.sundays=k,e.mondays=H,e.tuesdays=W,e.wednesdays=B,e.thursdays=G,e.fridays=Y,e.saturdays=Q,e.weeks=q,e.months=j,e.years=V,e.utcMillisecond=z,e.utcMilliseconds=X,e.utcSeconds=$,e.utcMinutes=K,e.utcHours=J,e.utcDays=Z,e.utcSundays=ee,e.utcMondays=te,e.utcTuesdays=ne,e.utcWednesdays=re,e.utcThursdays=ie,e.utcFridays=oe,e.utcSaturdays=ae,e.utcWeeks=ue,e.utcMonths=ce,e.utcYears=se,e.millisecond=a,e.second=u,e.minute=c,e.hour=s,e.day=l,e.sunday=d,e.monday=f,e.tuesday=p,e.wednesday=y,e.thursday=g,e.friday=h,e.saturday=m,e.week=d,e.month=v,e.year=E,e.utcSecond=T,e.utcMinute=N,e.utcHour=S,e.utcDay=A,e.utcSunday=O,e.utcMonday=C,e.utcTuesday=P,e.utcWednesday=I,e.utcThursday=b,e.utcFriday=R,e.utcSaturday=M,e.utcWeek=O,e.utcMonth=_,e.utcYear=U,e.interval=t})},{}],40:[function(e,t,n){function r(e){if(!e)throw Error("Missing binning options.");var t,n,r,u,c,s,l,d=e.maxbins||15,f=e.base||10,p=Math.log(f),y=e.div||[5,2],g=e.min,h=e.max,m=h-g;if(e.step)t=e.step;else if(e.steps)t=e.steps[Math.min(e.steps.length-1,i(e.steps,m/d,0,e.steps.length))];else{for(n=Math.ceil(Math.log(d)/p),r=e.minstep||0,t=Math.max(r,Math.pow(f,Math.round(Math.log(m)/p)-n));Math.ceil(m/t)>d;)t*=f;for(s=0;s<y.length;++s)c=t/y[s],c>=r&&m/c<=d&&(t=c)}return c=Math.log(t),u=c>=0?0:~~(-c/p)+1,l=Math.pow(f,-u-1),g=Math.min(g,Math.floor(g/t+l)*t),h=Math.ceil(h/t)*t,{start:g,stop:h,step:t,unit:{precision:u},value:o,index:a}}function i(e,t,n,r){for(;n<r;){var i=n+r>>>1;s.cmp(e[i],t)<0?n=i+1:r=i}return n}function o(e){return this.step*Math.floor(e/this.step+d)}function a(e){return Math.floor((e-this.start)/this.step+d)}function u(e){return this.unit.date(o.call(this,e))}function c(e){return a.call(this,this.unit.unit(e))}var s=e("../util"),l=e("../time"),d=1e-15;r.date=function(e){if(!e)throw Error("Missing date binning options.");var t=e.utc?l.utc:l,n=e.min,i=e.max,o=e.maxbins||20,a=e.minbins||4,s=+i-+n,d=e.unit?t[e.unit]:t.find(s,a,o),f=r({min:null!=d.min?d.min:d.unit(n),max:null!=d.max?d.max:d.unit(i),maxbins:o,minstep:d.minstep,steps:d.step});return f.unit=d,f.index=c,e.raw||(f.value=u),f},t.exports=r},{"../time":44,"../util":45}],41:[function(e,t,n){var r=e("./util"),i=t.exports;i.repeat=function(e,t){var n,r=Array(t);for(n=0;n<t;++n)r[n]=e;return r},i.zeros=function(e){return i.repeat(0,e)},i.range=function(e,t,n){if(arguments.length<3&&(n=1,arguments.length<2&&(t=e,e=0)),(t-e)/n==1/0)throw new Error("Infinite range");var r,i=[],o=-1;if(n<0)for(;(r=e+n*++o)>t;)i.push(r);else for(;(r=e+n*++o)<t;)i.push(r);return i},i.random={},i.random.uniform=function(e,t){void 0===t&&(t=void 0===e?1:e,e=0);var n=t-e,r=function(){return e+n*Math.random()};return r.samples=function(e){return i.zeros(e).map(r)},r.pdf=function(r){return r>=e&&r<=t?1/n:0},r.cdf=function(r){return r<e?0:r>t?1:(r-e)/n},r.icdf=function(t){return t>=0&&t<=1?e+t*n:NaN},r},i.random.integer=function(e,t){void 0===t&&(t=e,e=0);var n=t-e,r=function(){return e+Math.floor(n*Math.random())};return r.samples=function(e){return i.zeros(e).map(r)},r.pdf=function(r){return r===Math.floor(r)&&r>=e&&r<t?1/n:0},r.cdf=function(r){var i=Math.floor(r);return i<e?0:i>=t?1:(i-e+1)/n},r.icdf=function(t){return t>=0&&t<=1?e-1+Math.floor(t*n):NaN},r},i.random.normal=function(e,t){e=e||0,t=t||1;var n,r=function(){var r,i,o=0,a=0;if(void 0!==n)return o=n,n=void 0,o;do o=2*Math.random()-1,a=2*Math.random()-1,r=o*o+a*a;while(0===r||r>1);return i=Math.sqrt(-2*Math.log(r)/r),n=e+a*i*t,e+o*i*t};return r.samples=function(e){return i.zeros(e).map(r)},r.pdf=function(n){var r=Math.exp(Math.pow(n-e,2)/(-2*Math.pow(t,2)));return 1/(t*Math.sqrt(2*Math.PI))*r},r.cdf=function(n){var r,i=(n-e)/t,o=Math.abs(i);if(o>37)r=0;else{var a,u=Math.exp(-o*o/2);o<7.07106781186547?(a=.0352624965998911*o+.700383064443688,a=a*o+6.37396220353165,a=a*o+33.912866078383,a=a*o+112.079291497871,a=a*o+221.213596169931,a=a*o+220.206867912376,r=u*a,a=.0883883476483184*o+1.75566716318264,a=a*o+16.064177579207,a=a*o+86.7807322029461,a=a*o+296.564248779674,a=a*o+637.333633378831,a=a*o+793.826512519948,a=a*o+440.413735824752,r/=a):(a=o+.65,a=o+4/a,a=o+3/a,a=o+2/a,a=o+1/a,r=u/a/2.506628274631)}return i>0?1-r:r},r.icdf=function(n){if(n<=0||n>=1)return NaN;var r=2*n-1,i=8*(Math.PI-3)/(3*Math.PI*(4-Math.PI)),o=2/(Math.PI*i)+Math.log(1-Math.pow(r,2))/2,a=Math.log(1-r*r)/i,u=(r>0?1:-1)*Math.sqrt(Math.sqrt(o*o-a)-o);return e+t*Math.SQRT2*u},r},i.random.bootstrap=function(e,t){var n=e.filter(r.isValid),o=n.length,a=t?i.random.normal(0,t):null,u=function(){return n[~~(Math.random()*o)]+(a?a():0)};return u.samples=function(e){return i.zeros(e).map(u)},u}},{"./util":45}],42:[function(e,t,n){function r(e,t){return t?void(e[d]=t):e&&e[d]||null}function i(e){return l.keys(e)}function o(e){return"["+e+"]"}function a(e,t){e=l.array(e),t=l.$(t);var n,r,i;if(e[d]&&(n=t(e[d]),l.isString(n)))return n;for(r=0,i=e.length;!l.isValid(n)&&r<i;++r)n=t?t(e[r]):e[r];return l.isDate(n)?"date":l.isNumber(n)?"number":l.isBoolean(n)?"boolean":l.isString(n)?"string":null}function u(e,t){if(e.length){var n=t?l.identity:(t=i(e[0]),o);return t.reduce(function(t,r){return t[r]=a(e,n(r)),t},{})}}function c(e,t){e=l.array(e),t=l.$(t);var n,r,i,o=["boolean","integer","number","date"];for(n=0;n<e.length;++n){for(i=t?t(e[n]):e[n],r=0;r<o.length;++r)l.isValid(i)&&!p[o[r]](i)&&(o.splice(r,1),r-=1);if(0===o.length)return"string"}return o[0]}function s(e,t){var n=t?l.identity:(t=i(e[0]),o);return t.reduce(function(t,r){return t[r]=c(e,n(r)),t},{})}var l=e("../util"),d="__types__",f={"boolean":l["boolean"],integer:l.number,number:l.number,date:l.date,string:function(e){return null==e||""===e?null:e+""}},p={"boolean":function(e){return"true"===e||"false"===e||l.isBoolean(e)},integer:function(e){return p.number(e)&&(e=+e)===~~e},number:function(e){return!isNaN(+e)&&!l.isDate(e)},date:function(e){return!isNaN(Date.parse(e))}};a.annotation=r,a.all=u,a.infer=c,a.inferAll=s,a.parsers=f,t.exports=a},{"../util":45}],43:[function(e,t,n){function r(e,t,n){var r=e&&e.nullh||0,i=c.random.normal(0,1),o=s.mean(t,n),a=s.stdev(t,n)/Math.sqrt(s.count.valid(t,n));if(0===a)return o-r===0?1:0;var u=(o-r)/a;return 2*i.cdf(-Math.abs(u))}function i(e,t,n,r){var i,o=r?t.map(a.$(n)):t,u=r?t.map(a.$(r)):n,c=s.count(o),l=s.count(u),d=Array();if(c!==l)throw Error("Array lengths must match.");for(i=0;i<c;++i)a.isValid(o[i])&&a.isValid(u[i])&&d.push(o[i]-u[i]);return s.z.test(d,e&&e.nullh||0)}function o(e,t,n,r){var i=r?t.map(a.$(n)):t,o=r?t.map(a.$(r)):n,u=s.count.valid(i),l=s.count.valid(o),d=c.random.normal(0,1),f=s.mean(i)-s.mean(o)-(e&&e.nullh||0),p=Math.sqrt(s.variance(i)/u+s.variance(o)/l);if(0===p)return 0===f?1:0;var y=f/p;return 2*d.cdf(-Math.abs(y))}var a=e("./util"),u=e("./import/type"),c=e("./generate"),s=t.exports;s.unique=function(e,t,n){t=a.$(t),n=n||[];var r,i,o,u={};for(i=0,o=e.length;i<o;++i)r=t?t(e[i]):e[i],r in u||(u[r]=1,n.push(r));return n},s.count=function(e){return e&&e.length||0},s.count.valid=function(e,t){t=a.$(t);var n,r,i,o=0;for(r=0,i=e.length;r<i;++r)n=t?t(e[r]):e[r],a.isValid(n)&&(o+=1);return o},s.count.missing=function(e,t){t=a.$(t);var n,r,i,o=0;for(r=0,i=e.length;r<i;++r)n=t?t(e[r]):e[r],null==n&&(o+=1);return o},s.count.distinct=function(e,t){t=a.$(t);var n,r,i,o={},u=0;for(r=0,i=e.length;r<i;++r)n=t?t(e[r]):e[r],n in o||(o[n]=1,u+=1);return u},s.count.map=function(e,t){t=a.$(t);var n,r,i,o={};for(r=0,i=e.length;r<i;++r)n=t?t(e[r]):e[r],o[n]=n in o?o[n]+1:1;return o},s.median=function(e,t){return t&&(e=e.map(a.$(t))),e=e.filter(a.isValid).sort(a.cmp),s.quantile(e,.5)},s.quartile=function(e,t){t&&(e=e.map(a.$(t))),e=e.filter(a.isValid).sort(a.cmp);var n=s.quantile;return[n(e,.25),n(e,.5),n(e,.75)]},s.quantile=function(e,t,n){void 0===n&&(n=t,t=a.identity),t=a.$(t);var r=(e.length-1)*n+1,i=Math.floor(r),o=+t(e[i-1]),u=r-i;return u?o+u*(t(e[i])-o):o},s.sum=function(e,t){t=a.$(t);for(var n,r=0,i=0,o=e.length;i<o;++i)n=t?t(e[i]):e[i],a.isValid(n)&&(r+=n);return r},s.mean=function(e,t){t=a.$(t);var n,r,i,o,u,c=0;for(r=0,o=0,i=e.length;r<i;++r)u=t?t(e[r]):e[r],a.isValid(u)&&(n=u-c,c+=n/++o);return c},s.mean.geometric=function(e,t){t=a.$(t);var n,r,i,o,u=1;for(o=0,n=0,r=e.length;o<r;++o)if(i=t?t(e[o]):e[o],a.isValid(i)){if(i<=0)throw Error("Geometric mean only defined for positive values.");u*=i,++n}return u=n>0?Math.pow(u,1/n):0},s.mean.harmonic=function(e,t){t=a.$(t);var n,r,i,o,u=0;for(o=0,n=0,r=e.length;o<r;++o)i=t?t(e[o]):e[o],a.isValid(i)&&(u+=1/i,++n);return n/u},s.variance=function(e,t){if(t=a.$(t),!a.isArray(e)||e.length<2)return 0;var n,r,i,o,u=0,c=0;for(r=0,i=0;r<e.length;++r)o=t?t(e[r]):e[r],a.isValid(o)&&(n=o-u,u+=n/++i,c+=n*(o-u));return c/=i-1},s.stdev=function(e,t){return Math.sqrt(s.variance(e,t))},s.modeskew=function(e,t){var n=s.mean(e,t),r=s.median(e,t),i=s.stdev(e,t);return 0===i?0:(n-r)/i},s.min=function(e,t){return s.extent(e,t)[0]},s.max=function(e,t){return s.extent(e,t)[1]},s.extent=function(e,t){t=a.$(t);var n,r,i,o,u=e.length;for(o=0;o<u;++o)if(i=t?t(e[o]):e[o],a.isValid(i)){n=r=i;break}for(;o<u;++o)i=t?t(e[o]):e[o],a.isValid(i)&&(i<n&&(n=i),i>r&&(r=i));return[n,r]},s.extent.index=function(e,t){t=a.$(t);var n,r,i,o,u=-1,c=-1,s=e.length;for(o=0;o<s;++o)if(i=t?t(e[o]):e[o],a.isValid(i)){n=r=i,u=c=o;break}for(;o<s;++o)i=t?t(e[o]):e[o],a.isValid(i)&&(i<n&&(n=i,u=o),i>r&&(r=i,c=o));return[u,c]},s.dot=function(e,t,n){var r,i,o=0;if(n)for(t=a.$(t),n=a.$(n),r=0;r<e.length;++r)i=t(e[r])*n(e[r]),i===i&&(o+=i);else{if(e.length!==t.length)throw Error("Array lengths must match.");for(r=0;r<e.length;++r)i=e[r]*t[r],i===i&&(o+=i)}return o},s.dist=function(e,t,n,r){var i,o,u=a.isFunction(n)||a.isString(n),c=e,s=u?e:t,l=u?r:n,d=2===l||null==l,f=e.length,p=0;for(u&&(t=a.$(t),n=a.$(n)),o=0;o<f;++o)i=u?t(c[o])-n(s[o]):c[o]-s[o],p+=d?i*i:Math.pow(Math.abs(i),l);return d?Math.sqrt(p):Math.pow(p,1/l)},s.cohensd=function(e,t,n){var r=n?e.map(a.$(t)):e,i=n?e.map(a.$(n)):t,o=s.mean(r),u=s.mean(i),c=s.count.valid(r),l=s.count.valid(i);if(c+l-2<=0)return 0;var d=s.variance(r),f=s.variance(i),p=Math.sqrt(((c-1)*d+(l-1)*f)/(c+l-2));return 0===p?0:(o-u)/p},s.covariance=function(e,t,n){var r,i,o,u,c,l=n?e.map(a.$(t)):e,d=n?e.map(a.$(n)):t,f=l.length,p=s.mean(l),y=s.mean(d),g=0,h=0;if(f!==d.length)throw Error("Input lengths must match.");for(r=0;r<f;++r)if(i=l[r],u=a.isValid(i),o=d[r],c=a.isValid(o),u&&c)g+=(i-p)*(o-y),++h;else if(u||c)throw Error("Valid values must align.");return g/(h-1)},s.rank=function(e,t){t=a.$(t)||a.identity;var n,r,i,o=e.map(function(e,n){return{idx:n,val:t(e)}}).sort(a.comparator("val")),u=e.length,c=Array(u),s=-1,l={};for(n=0;n<u;++n){if(r=o[n].val,s<0&&l===r)s=n-1;else if(s>-1&&l!==r){for(i=1+(n-1+s)/2;s<n;++s)c[o[s].idx]=i;s=-1}c[o[n].idx]=n+1,l=r}if(s>-1)for(i=1+(u-1+s)/2;s<u;++s)c[o[s].idx]=i;return c},s.cor=function(e,t,n){var r=n;n=r?e.map(a.$(n)):t,t=r?e.map(a.$(t)):e;var i=s.dot(t,n),o=s.mean(t),u=s.mean(n),c=s.stdev(t),l=s.stdev(n),d=e.length;return(i-d*o*u)/((d-1)*c*l)},s.cor.rank=function(e,t,n){var r,i,o,a=n?s.rank(e,t):s.rank(e),u=n?s.rank(e,n):s.rank(t),c=e.length;for(r=0,i=0;r<c;++r)o=a[r]-u[r],i+=o*o;return 1-6*i/(c*(c*c-1))},s.cor.dist=function(e,t,n){var r,i,o,u,c=n?e.map(a.$(t)):e,l=n?e.map(a.$(n)):t,d=s.dist.mat(c),f=s.dist.mat(l),p=d.length;for(r=0,i=0,o=0,u=0;r<p;++r)i+=d[r]*d[r],o+=f[r]*f[r],u+=d[r]*f[r];return Math.sqrt(u/Math.sqrt(i*o))},s.linearRegression=function(e,t,n){var r,i,o=n?e.map(a.$(t)):e,u=n?e.map(a.$(n)):t,c=o.length,l=s.covariance(o,u),d=s.stdev(o),f=s.stdev(u),p=l/(d*d),y=s.mean(u)-p*s.mean(o),g={
slope:p,intercept:y,R:l/(d*f),rss:0};for(i=0;i<c;++i)a.isValid(o[i])&&a.isValid(u[i])&&(r=p*o[i]+y-u[i],g.rss+=r*r);return g},s.bootstrap={},s.bootstrap.ci=function(e,t,n,r,i){var o,u,l,d,f,p,y;for(a.isFunction(t)||a.isString(t)?(o=e.map(a.$(t)),u=n,l=r,d=i):(o=e,u=t,l=n,d=r),u=u?+u:1e3,l=l||.05,f=c.random.bootstrap(o,d),y=0,p=Array(u);y<u;++y)p[y]=s.mean(f.samples(o.length));return p.sort(a.numcmp),[s.quantile(p,l/2),s.quantile(p,1-l/2)]},s.z={},s.z.ci=function(e,t,n){var r=e,i=t;(a.isFunction(t)||a.isString(t))&&(r=e.map(a.$(t)),i=n),i=i||.05;var o=.05===i?1.96:c.random.normal(0,1).icdf(1-i/2),u=s.mean(r),l=s.stdev(r)/Math.sqrt(s.count.valid(r));return[u-o*l,u+o*l]},s.z.test=function(e,t,n,u){return a.isFunction(n)||a.isString(n)?(u&&u.paired?i:o)(u,e,t,n):a.isArray(t)?(n&&n.paired?i:o)(n,e,t):a.isFunction(t)||a.isString(t)?r(n,e,t):r(t,e)},s.dist.mat=function(e){var t,n,r,i=e.length,o=i*i,a=Array(o),u=c.zeros(i),s=0;for(n=0;n<i;++n)for(a[n*i+n]=0,r=n+1;r<i;++r)a[n*i+r]=t=Math.abs(e[n]-e[r]),a[r*i+n]=t,u[n]+=t,u[r]+=t;for(n=0;n<i;++n)s+=u[n],u[n]/=i;for(s/=o,n=0;n<i;++n)for(r=n;r<i;++r)a[n*i+r]+=s-u[n]-u[r],a[r*i+n]=a[n*i+r];return a},s.entropy=function(e,t){t=a.$(t);var n,r,i=0,o=0,u=e.length;for(n=0;n<u;++n)i+=t?t(e[n]):e[n];if(0===i)return 0;for(n=0;n<u;++n)r=(t?t(e[n]):e[n])/i,r&&(o+=r*Math.log(r));return-o/Math.LN2},s.mutual=function(e,t,n,r){var i,o,u,c=r?e.map(a.$(t)):e,s=r?e.map(a.$(n)):t,l=r?e.map(a.$(r)):n,d={},f={},p=l.length,y=0,g=0,h=0;for(u=0;u<p;++u)d[c[u]]=0,f[s[u]]=0;for(u=0;u<p;++u)d[c[u]]+=l[u],f[s[u]]+=l[u],y+=l[u];for(o=1/(y*Math.LN2),u=0;u<p;++u)0!==l[u]&&(i=y*l[u]/(d[c[u]]*f[s[u]]),g+=l[u]*o*Math.log(i),h+=l[u]*o*Math.log(l[u]/y));return[g,1+g/h]},s.mutual.info=function(e,t,n,r){return s.mutual(e,t,n,r)[0]},s.mutual.dist=function(e,t,n,r){return s.mutual(e,t,n,r)[1]},s.profile=function(e,t){var n,r,i,o,c,l=0,d=0,f=0,p=0,y=null,g=null,h=0,m=[],v={};for(i=0;i<e.length;++i)o=t?t(e[i]):e[i],v[o]=o in v?v[o]+1:(p+=1,1),null==o?++f:a.isValid(o)&&(c="string"==typeof o?o.length:o,(null===y||c<y)&&(y=c),(null===g||c>g)&&(g=c),n=c-l,l+=n/++d,h+=n*(c-l),m.push(c));return h/=d-1,r=Math.sqrt(h),m.sort(a.cmp),{type:u(e,t),unique:v,count:e.length,valid:d,missing:f,distinct:p,min:y,max:g,mean:l,stdev:r,median:o=s.quantile(m,.5),q1:s.quantile(m,.25),q3:s.quantile(m,.75),modeskew:0===r?0:(l-o)/r}},s.summary=function(e,t){t=t||a.keys(e[0]);var n=t.map(function(t){var n=s.profile(e,a.$(t));return n.field=t,n});return n.__summary__=!0,n}},{"./generate":41,"./import/type":42,"./util":45}],44:[function(e,t,n){function r(e){return s.setTime(+e),s}function i(e,t,n,r,i,o){var a={type:e,date:t,unit:n};return r?a.step=r:a.minstep=1,null!=i&&(a.min=i),null!=o&&(a.max=o),a}function o(e,t,n,r,o,a){return i(e,function(e){return t.offset(n,e)},function(e){return t.count(n,e)},r,o,a)}function a(e,t,n,r){var i,o,a,u=y[0];for(i=1,o=y.length;i<o;++i)if(u=y[i],t>u[0]){if(a=t/u[0],a>r)return e[y[i-1][1]];if(a>=n)return e[u[1]]}return e[y[o-1][1]]}function u(e){var t,n,r={};for(t=0,n=e.length;t<n;++t)r[e[t].type]=e[t];return r.find=function(t,n,r){return a(e,t,n,r)},r}var c=e("d3-time"),s=new Date,l=new Date(0,0,1).setFullYear(0),d=new Date(Date.UTC(0,0,1)).setUTCFullYear(0),f=[o("second",c.second,l),o("minute",c.minute,l),o("hour",c.hour,l),o("day",c.day,l,[1,7]),o("month",c.month,l,[1,3,6]),o("year",c.year,l),i("seconds",function(e){return new Date(1970,0,1,0,0,e)},function(e){return r(e).getSeconds()},null,0,59),i("minutes",function(e){return new Date(1970,0,1,0,e)},function(e){return r(e).getMinutes()},null,0,59),i("hours",function(e){return new Date(1970,0,1,e)},function(e){return r(e).getHours()},null,0,23),i("weekdays",function(e){return new Date(1970,0,4+e)},function(e){return r(e).getDay()},[1],0,6),i("dates",function(e){return new Date(1970,0,e)},function(e){return r(e).getDate()},[1],1,31),i("months",function(e){return new Date(1970,e%12,1)},function(e){return r(e).getMonth()},[1],0,11)],p=[o("second",c.utcSecond,d),o("minute",c.utcMinute,d),o("hour",c.utcHour,d),o("day",c.utcDay,d,[1,7]),o("month",c.utcMonth,d,[1,3,6]),o("year",c.utcYear,d),i("seconds",function(e){return new Date(Date.UTC(1970,0,1,0,0,e))},function(e){return r(e).getUTCSeconds()},null,0,59),i("minutes",function(e){return new Date(Date.UTC(1970,0,1,0,e))},function(e){return r(e).getUTCMinutes()},null,0,59),i("hours",function(e){return new Date(Date.UTC(1970,0,1,e))},function(e){return r(e).getUTCHours()},null,0,23),i("weekdays",function(e){return new Date(Date.UTC(1970,0,4+e))},function(e){return r(e).getUTCDay()},[1],0,6),i("dates",function(e){return new Date(Date.UTC(1970,0,e))},function(e){return r(e).getUTCDate()},[1],1,31),i("months",function(e){return new Date(Date.UTC(1970,e%12,1))},function(e){return r(e).getUTCMonth()},[1],0,11)],y=[[31536e6,5],[7776e6,4],[2592e6,4],[12096e5,3],[6048e5,3],[1728e5,3],[864e5,3],[432e5,2],[216e5,2],[108e5,2],[36e5,2],[18e5,1],[9e5,1],[3e5,1],[6e4,1],[3e4,0],[15e3,0],[5e3,0],[1e3,0]];t.exports=u(f),t.exports.utc=u(p)},{"d3-time":39}],45:[function(e,t,n){(function(e){function n(e,t){var n,r="";for(n=0;n<e;++n)r+=t;return r}function r(e,t,n){var r=0,i=e.split(c);return e=n?(i=i.reverse()).filter(function(e){return r+=e.length,r<=t}).reverse():i.filter(function(e){return r+=e.length,r<=t}),e.length?e.join("").trim():i[0].slice(0,t)}var i=t.exports,o="__name__";i.namedfunc=function(e,t){return t[o]=e,t},i.name=function(e){return null==e?null:e[o]},i.identity=function(e){return e},i["true"]=i.namedfunc("true",function(){return!0}),i["false"]=i.namedfunc("false",function(){return!1}),i.duplicate=function(e){return JSON.parse(JSON.stringify(e))},i.equal=function(e,t){return JSON.stringify(e)===JSON.stringify(t)},i.extend=function(e){for(var t,n,r=1,i=arguments.length;r<i;++r){t=arguments[r];for(n in t)e[n]=t[n]}return e},i.length=function(e){return null!=e&&null!=e.length?e.length:null},i.keys=function(e){var t,n=[];for(t in e)n.push(t);return n},i.vals=function(e){var t,n=[];for(t in e)n.push(e[t]);return n},i.toMap=function(e,t){return(t=i.$(t))?e.reduce(function(e,n){return e[t(n)]=1,e},{}):e.reduce(function(e,t){return e[t]=1,e},{})},i.keystr=function(e){var t=e.length;if(!t)return"";for(var n=String(e[0]),r=1;r<t;++r)n+="|"+String(e[r]);return n};var a=Object.prototype.toString;i.isObject=function(e){return e===Object(e)},i.isFunction=function(e){return"[object Function]"===a.call(e)},i.isString=function(e){return"string"==typeof value||"[object String]"===a.call(e)},i.isArray=Array.isArray||function(e){return"[object Array]"===a.call(e)},i.isNumber=function(e){return"number"==typeof e||"[object Number]"===a.call(e)},i.isBoolean=function(e){return e===!0||e===!1||"[object Boolean]"==a.call(e)},i.isDate=function(e){return"[object Date]"===a.call(e)},i.isValid=function(e){return null!=e&&e===e},i.isBuffer="function"==typeof e&&e.isBuffer||i["false"],i.number=function(e){return null==e||""===e?null:+e},i["boolean"]=function(e){return null==e||""===e?null:"false"!==e&&!!e},i.date=function(e,t){var n=t?t:Date;return null==e||""===e?null:n.parse(e)},i.array=function(e){return null!=e?i.isArray(e)?e:[e]:[]},i.str=function(e){return i.isArray(e)?"["+e.map(i.str)+"]":i.isObject(e)||i.isString(e)?JSON.stringify(e).replace("\u2028","\\u2028").replace("\u2029","\\u2029"):e};var u=/\[(.*?)\]|[^.\[]+/g;i.field=function(e){return String(e).match(u).map(function(e){return"["!==e[0]?e:"'"!==e[1]&&'"'!==e[1]?e.slice(1,-1):e.slice(2,-2).replace(/\\(["'])/g,"$1")})},i.accessor=function(e){return null==e||i.isFunction(e)?e:i.namedfunc(e,Function("x","return x["+i.field(e).map(i.str).join("][")+"];"))},i.$=i.accessor,i.mutator=function(e){var t;return i.isString(e)&&(t=i.field(e)).length>1?function(e,n){for(var r=0;r<t.length-1;++r)e=e[t[r]];e[t[r]]=n}:function(t,n){t[e]=n}},i.$func=function(e,t){return function(n){n=i.$(n)||i.identity;var r=e+(i.name(n)?"_"+i.name(n):"");return i.namedfunc(r,function(e){return t(n(e))})}},i.$valid=i.$func("valid",i.isValid),i.$length=i.$func("length",i.length),i.$in=function(e,t){e=i.$(e);var n=i.isArray(t)?i.toMap(t):t;return function(t){return!!n[e(t)]}},i.comparator=function(e){var t=[];return void 0===e&&(e=[]),e=i.array(e).map(function(e){var n=1;return"-"===e[0]?(n=-1,e=e.slice(1)):"+"===e[0]&&(n=1,e=e.slice(1)),t.push(n),i.accessor(e)}),function(n,r){var o,a,u,c;for(o=0,a=e.length;o<a;++o)if(u=e[o],c=i.cmp(u(n),u(r)))return c*t[o];return 0}},i.cmp=function(e,t){return(e<t||null==e)&&null!=t?-1:(e>t||null==t)&&null!=e?1:(t=t instanceof Date?+t:t,(e=e instanceof Date?+e:e)!==e&&t===t?-1:t!==t&&e===e?1:0)},i.numcmp=function(e,t){return e-t},i.stablesort=function(e,t,n){var r=e.reduce(function(e,t,r){return e[n(t)]=r,e},{});return e.sort(function(e,i){var o=t(e),a=t(i);return o<a?-1:o>a?1:r[n(e)]-r[n(i)]}),e},i.permute=function(e){for(var t,n,r=e.length;r;)n=Math.floor(Math.random()*r--),t=e[r],e[r]=e[n],e[n]=t},i.pad=function(e,t,r,i){i=i||" ";var o=t-e.length;if(o<=0)return e;switch(r){case"left":return n(o,i)+e;case"middle":case"center":return n(Math.floor(o/2),i)+e+n(Math.ceil(o/2),i);default:return e+n(o,i)}},i.truncate=function(e,t,n,i,o){var a=e.length;if(a<=t)return e;o=void 0!==o?String(o):"…";var u=Math.max(0,t-o.length);switch(n){case"left":return o+(i?r(e,u,1):e.slice(a-u));case"middle":case"center":var c=Math.ceil(u/2),s=Math.floor(u/2);return(i?r(e,c):e.slice(0,c))+o+(i?r(e,s,1):e.slice(a-s));default:return(i?r(e,u):e.slice(0,u))+o}};var c=/([\u0009\u000A\u000B\u000C\u000D\u0020\u00A0\u1680\u180E\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200A\u202F\u205F\u2028\u2029\u3000\uFEFF])/}).call(this,e("buffer").Buffer)},{buffer:38}],46:[function(e,t,n){var r="undefined"!=typeof JSON?JSON:e("jsonify");t.exports=function(e,t){t||(t={}),"function"==typeof t&&(t={cmp:t});var n=t.space||"";"number"==typeof n&&(n=Array(n+1).join(" "));var a="boolean"==typeof t.cycles&&t.cycles,u=t.replacer||function(e,t){return t},c=t.cmp&&function(e){return function(t){return function(n,r){var i={key:n,value:t[n]},o={key:r,value:t[r]};return e(i,o)}}}(t.cmp),s=[];return function l(e,t,d,f){var p=n?"\n"+new Array(f+1).join(n):"",y=n?": ":":";if(d&&d.toJSON&&"function"==typeof d.toJSON&&(d=d.toJSON()),d=u.call(e,t,d),void 0!==d){if("object"!=typeof d||null===d)return r.stringify(d);if(i(d)){for(var g=[],h=0;h<d.length;h++){var m=l(d,h,d[h],f+1)||r.stringify(null);g.push(p+n+m)}return"["+g.join(",")+p+"]"}if(s.indexOf(d)!==-1){if(a)return r.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}s.push(d);for(var v=o(d).sort(c&&c(d)),g=[],h=0;h<v.length;h++){var t=v[h],E=l(d,t,d[t],f+1);if(E){var T=r.stringify(t)+y+E;g.push(p+n+T)}}return s.splice(s.indexOf(d),1),"{"+g.join(",")+p+"}"}}({"":e},"",e,0)};var i=Array.isArray||function(e){return"[object Array]"==={}.toString.call(e)},o=Object.keys||function(e){var t=Object.prototype.hasOwnProperty||function(){return!0},n=[];for(var r in e)t.call(e,r)&&n.push(r);return n}},{jsonify:47}],47:[function(e,t,n){n.parse=e("./lib/parse"),n.stringify=e("./lib/stringify")},{"./lib/parse":48,"./lib/stringify":49}],48:[function(e,t,n){var r,i,o,a,u={'"':'"',"\\":"\\","/":"/",b:"\b",f:"\f",n:"\n",r:"\r",t:"\t"},c=function(e){throw{name:"SyntaxError",message:e,at:r,text:o}},s=function(e){return e&&e!==i&&c("Expected '"+e+"' instead of '"+i+"'"),i=o.charAt(r),r+=1,i},l=function(){var e,t="";for("-"===i&&(t="-",s("-"));i>="0"&&i<="9";)t+=i,s();if("."===i)for(t+=".";s()&&i>="0"&&i<="9";)t+=i;if("e"===i||"E"===i)for(t+=i,s(),"-"!==i&&"+"!==i||(t+=i,s());i>="0"&&i<="9";)t+=i,s();return e=+t,isFinite(e)?e:void c("Bad number")},d=function(){var e,t,n,r="";if('"'===i)for(;s();){if('"'===i)return s(),r;if("\\"===i)if(s(),"u"===i){for(n=0,t=0;t<4&&(e=parseInt(s(),16),isFinite(e));t+=1)n=16*n+e;r+=String.fromCharCode(n)}else{if("string"!=typeof u[i])break;r+=u[i]}else r+=i}c("Bad string")},f=function(){for(;i&&i<=" ";)s()},p=function(){switch(i){case"t":return s("t"),s("r"),s("u"),s("e"),!0;case"f":return s("f"),s("a"),s("l"),s("s"),s("e"),!1;case"n":return s("n"),s("u"),s("l"),s("l"),null}c("Unexpected '"+i+"'")},y=function(){var e=[];if("["===i){if(s("["),f(),"]"===i)return s("]"),e;for(;i;){if(e.push(a()),f(),"]"===i)return s("]"),e;s(","),f()}}c("Bad array")},g=function(){var e,t={};if("{"===i){if(s("{"),f(),"}"===i)return s("}"),t;for(;i;){if(e=d(),f(),s(":"),Object.hasOwnProperty.call(t,e)&&c('Duplicate key "'+e+'"'),t[e]=a(),f(),"}"===i)return s("}"),t;s(","),f()}}c("Bad object")};a=function(){switch(f(),i){case"{":return g();case"[":return y();case'"':return d();case"-":return l();default:return i>="0"&&i<="9"?l():p()}},t.exports=function(e,t){var n;return o=e,r=0,i=" ",n=a(),f(),i&&c("Syntax error"),"function"==typeof t?function u(e,n){var r,i,o=e[n];if(o&&"object"==typeof o)for(r in o)Object.prototype.hasOwnProperty.call(o,r)&&(i=u(o,r),void 0!==i?o[r]=i:delete o[r]);return t.call(e,n,o)}({"":n},""):n}},{}],49:[function(e,t,n){function r(e){return c.lastIndex=0,c.test(e)?'"'+e.replace(c,function(e){var t=s[e];return"string"==typeof t?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function i(e,t){var n,c,s,l,d,f=o,p=t[e];switch(p&&"object"==typeof p&&"function"==typeof p.toJSON&&(p=p.toJSON(e)),"function"==typeof u&&(p=u.call(t,e,p)),typeof p){case"string":return r(p);case"number":return isFinite(p)?String(p):"null";case"boolean":case"null":return String(p);case"object":if(!p)return"null";if(o+=a,d=[],"[object Array]"===Object.prototype.toString.apply(p)){for(l=p.length,n=0;n<l;n+=1)d[n]=i(n,p)||"null";return s=0===d.length?"[]":o?"[\n"+o+d.join(",\n"+o)+"\n"+f+"]":"["+d.join(",")+"]",o=f,s}if(u&&"object"==typeof u)for(l=u.length,n=0;n<l;n+=1)c=u[n],"string"==typeof c&&(s=i(c,p),s&&d.push(r(c)+(o?": ":":")+s));else for(c in p)Object.prototype.hasOwnProperty.call(p,c)&&(s=i(c,p),s&&d.push(r(c)+(o?": ":":")+s));return s=0===d.length?"{}":o?"{\n"+o+d.join(",\n"+o)+"\n"+f+"}":"{"+d.join(",")+"}",o=f,s}}var o,a,u,c=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,s={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};t.exports=function(e,t,n){var r;if(o="",a="","number"==typeof n)for(r=0;r<n;r+=1)a+=" ";else"string"==typeof n&&(a=n);if(u=t,t&&"function"!=typeof t&&("object"!=typeof t||"number"!=typeof t.length))throw new Error("JSON.stringify");return i("",{"":e})}},{}],50:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.AGGREGATE_OPS=["values","count","valid","missing","distinct","sum","mean","average","variance","variancep","stdev","stdevp","median","q1","q3","modeskew","min","max","argmin","argmax"],n.SUM_OPS=["count","sum","distinct","valid","missing"],n.SHARED_DOMAIN_OPS=["mean","average","median","q1","q3","min","max"]},{}],51:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.defaultAxisConfig={labelMaxLength:25},n.AXIS_PROPERTIES=["domain","format","grid","labelPadding","labels","maxExtent","minExtent","offset","orient","position","tickCount","ticks","tickSize","title","titlePadding","values","zindex"],n.VL_ONLY_AXIS_PROPERTIES=["labelMaxLength"]},{}],52:[function(e,t,n){"use strict";function r(e){switch(e){case i.ROW:case i.COLUMN:case i.SIZE:case i.SHAPE:return 6;default:return 10}}Object.defineProperty(n,"__esModule",{value:!0});var i=e("./channel");n.autoMaxBins=r},{"./channel":53}],53:[function(e,t,n){"use strict";function r(e,t){return t in i(e)}function i(e){switch(e){case n.X:case n.Y:case n.COLOR:case n.DETAIL:case n.ORDER:case n.OPACITY:case n.ROW:case n.COLUMN:return{point:!0,tick:!0,rule:!0,circle:!0,square:!0,bar:!0,rect:!0,line:!0,area:!0,text:!0};case n.X2:case n.Y2:return{rule:!0,bar:!0,rect:!0,area:!0};case n.SIZE:return{point:!0,tick:!0,rule:!0,circle:!0,square:!0,bar:!0,text:!0,line:!0};case n.SHAPE:return{point:!0};case n.TEXT:return{text:!0}}return{}}function o(e){return!l.contains([n.DETAIL,n.TEXT,n.ORDER],e)}function a(e,t){switch(e){case n.ROW:case n.COLUMN:return"band"===t;case n.X:case n.Y:case n.SIZE:case n.OPACITY:return t in d;case n.COLOR:return"band"!==t;case n.SHAPE:return"ordinal"===t}return!1}function u(e){switch(e){case n.X:case n.Y:case n.SIZE:case n.OPACITY:return"continuous";case n.ROW:case n.COLUMN:case n.SHAPE:return"discrete";case n.COLOR:return"flexible";case n.X2:case n.Y2:case n.DETAIL:case n.TEXT:case n.ORDER:return}throw new Error("getSupportedRole not implemented for "+e)}Object.defineProperty(n,"__esModule",{value:!0});var c,s=e("./scale"),l=e("./util");!function(e){e.ROW="row",e.COLUMN="column",e.X="x",e.Y="y",e.X2="x2",e.Y2="y2",e.COLOR="color",e.SHAPE="shape",e.SIZE="size",e.OPACITY="opacity",e.TEXT="text",e.ORDER="order",e.DETAIL="detail"}(c=n.Channel||(n.Channel={})),n.X=c.X,n.Y=c.Y,n.X2=c.X2,n.Y2=c.Y2,n.ROW=c.ROW,n.COLUMN=c.COLUMN,n.SHAPE=c.SHAPE,n.SIZE=c.SIZE,n.COLOR=c.COLOR,n.TEXT=c.TEXT,n.DETAIL=c.DETAIL,n.ORDER=c.ORDER,n.OPACITY=c.OPACITY,n.CHANNELS=[n.X,n.Y,n.X2,n.Y2,n.ROW,n.COLUMN,n.SIZE,n.SHAPE,n.COLOR,n.ORDER,n.OPACITY,n.TEXT,n.DETAIL],n.UNIT_CHANNELS=[n.X,n.Y,n.X2,n.Y2,n.SIZE,n.SHAPE,n.COLOR,n.ORDER,n.OPACITY,n.TEXT,n.DETAIL],n.UNIT_SCALE_CHANNELS=[n.X,n.Y,n.SIZE,n.SHAPE,n.COLOR,n.OPACITY],n.SCALE_CHANNELS=[n.X,n.Y,n.SIZE,n.SHAPE,n.COLOR,n.OPACITY,n.ROW,n.COLUMN],n.NONSPATIAL_CHANNELS=[n.SIZE,n.SHAPE,n.COLOR,n.ORDER,n.OPACITY,n.TEXT,n.DETAIL],n.NONSPATIAL_SCALE_CHANNELS=[n.SIZE,n.SHAPE,n.COLOR,n.OPACITY],n.STACK_GROUP_CHANNELS=[n.COLOR,n.DETAIL,n.ORDER,n.OPACITY,n.SIZE],n.supportMark=r,n.getSupportedMark=i,n.hasScale=o;var d=l.toSet(l.without(s.SCALE_TYPES,["ordinal","sequential"]));n.supportScaleType=a,n.rangeType=u},{"./scale":60,"./util":63}],54:[function(e,t,n){"use strict";function r(e,t,n,r,o,a,s){var l=i(t,n,r,o,a,s);return c.hasScale(t)?void 0!==e?n.bin?(u.warn(u.message.cannotOverrideBinScaleType(t,l)),l):c.supportScaleType(t,e)?e:(u.warn(u.message.scaleTypeNotWorkWithChannel(t,e,l)),l):l:null}function i(e,t,n,r,i,a){if(l.contains(["row","column"],e))return"band";switch(t.type){case"nominal":return"color"===e||"discrete"===c.rangeType(e)?"ordinal":o(e,n,r,i,a);case"ordinal":return"color"===e?"ordinal":"discrete"===c.rangeType(e)?(u.warn(u.message.discreteChannelCannotEncode(e,"ordinal")),"ordinal"):o(e,n,r,i,a);case"temporal":return"color"===e?"sequential":"discrete"===c.rangeType(e)?(u.warn(u.message.discreteChannelCannotEncode(e,"temporal")),"ordinal"):s.isDiscreteByDefault(t.timeUnit)?o(e,n,r,i,a):"time";case"quantitative":return"color"===e?t.bin?"bin-ordinal":"sequential":"discrete"===c.rangeType(e)?(u.warn(u.message.discreteChannelCannotEncode(e,"quantitative")),"ordinal"):t.bin?"bin-linear":"linear"}throw new Error(u.message.invalidFieldType(t.type))}function o(e,t,n,r,i){if(l.contains(["x","y"],e)){if("rect"===t)return"band";if("bar"===t)return a(n,r,i)?"point":"band"}return"point"}function a(e,t,n){return!e&&(void 0!==t?null!==t:!!n.rangeStep)}Object.defineProperty(n,"__esModule",{value:!0});var u=e("../../log"),c=e("../../channel"),s=e("../../timeunit"),l=e("../../util");n["default"]=r},{"../../channel":53,"../../log":58,"../../timeunit":61,"../../util":63}],55:[function(e,t,n){"use strict";function r(e){return!!(e&&(e.year||e.quarter||e.month||e.date||e.day||e.hours||e.minutes||e.seconds||e.milliseconds))}function i(e){if(s.isNumber(e))return e>4&&l.warn(l.message.invalidTimeUnit("quarter",e)),e-1+"";throw new Error(l.message.invalidTimeUnit("quarter",e))}function o(e){if(s.isNumber(e))return e-1+"";var t=e.toLowerCase(),r=n.MONTHS.indexOf(t);if(r!==-1)return r+"";var i=t.substr(0,3),o=n.SHORT_MONTHS.indexOf(i);if(o!==-1)return o+"";throw new Error(l.message.invalidTimeUnit("month",e))}function a(e){if(s.isNumber(e))return e%7+"";var t=e.toLowerCase(),r=n.DAYS.indexOf(t);if(r!==-1)return r+"";var i=t.substr(0,3),o=n.SHORT_DAYS.indexOf(i);if(o!==-1)return o+"";throw new Error(l.message.invalidTimeUnit("day",e))}function u(e,t){var n=new Date(0,0,1,0,0,0,0);if(void 0!==e.day)if(s.keys(e).length>1)l.warn(l.message.droppedDay(e)),e=s.duplicate(e),delete e.day;else{n.setFullYear(d);var r=t?a(e.day):e.day;n.setDate(+r+1)}if(void 0!==e.year&&n.setFullYear(e.year),void 0!==e.quarter){var u=t?i(e.quarter):e.quarter;n.setMonth(3*+u)}if(void 0!==e.month){var c=t?o(e.month):e.month;n.setMonth(+c)}return void 0!==e.date&&n.setDate(e.date),void 0!==e.hours&&n.setHours(e.hours),void 0!==e.minutes&&n.setMinutes(e.minutes),void 0!==e.seconds&&n.setSeconds(e.seconds),void 0!==e.milliseconds&&n.setMilliseconds(e.milliseconds),n.getTime()}function c(e,t){void 0===t&&(t=!1);var n=[];if(t&&void 0!==e.day&&s.keys(e).length>1&&(l.warn(l.message.droppedDay(e)),e=s.duplicate(e),delete e.day),void 0!==e.year?n.push(e.year):void 0!==e.day?n.push(d):n.push(0),void 0!==e.month){var r=t?o(e.month):e.month;n.push(r)}else if(void 0!==e.quarter){var u=t?i(e.quarter):e.quarter;n.push(u+"*3")}else n.push(0);if(void 0!==e.date)n.push(e.date);else if(void 0!==e.day){var c=t?a(e.day):e.day;n.push(c+"+1")}else n.push(1);for(var f=0,p=["hours","minutes","seconds","milliseconds"];f<p.length;f++){var y=p[f];void 0!==e[y]?n.push(e[y]):n.push(0)}return"datetime("+n.join(", ")+")"}Object.defineProperty(n,"__esModule",{value:!0});var s=e("./util"),l=e("./log"),d=2006;n.isDateTime=r,n.MONTHS=["january","february","march","april","may","june","july","august","september","october","november","december"],n.SHORT_MONTHS=n.MONTHS.map(function(e){return e.substr(0,3)}),n.DAYS=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"],n.SHORT_DAYS=n.DAYS.map(function(e){return e.substr(0,3)}),n.timestamp=u,n.dateTimeExpr=c},{"./log":58,"./util":63}],56:[function(e,t,n){"use strict";function r(e){return e&&(!!e.field||"count"===e.aggregate)}function i(e){return e&&"value"in e&&void 0!==e.value}function o(e,t){void 0===t&&(t={});var n=e.field,r=t.prefix,i=t.suffix;if(c(e))n="count_*";else{var o=void 0;t.nofn||(e.bin?(o="bin",i=t.binSuffix):e.aggregate?o=String(t.aggregate||e.aggregate):e.timeUnit&&(o=String(e.timeUnit))),o&&(n=o+"_"+n)}return i&&(n=n+"_"+i),r&&(n=r+"_"+n),t.datum&&(n='datum["'+n+'"]'),n}function a(e){switch(e.type){case"nominal":case"ordinal":return!0;case"quantitative":return!!e.bin;case"temporal":return g.isDiscreteByDefault(e.timeUnit)}throw new Error(y.message.invalidFieldType(e.type))}function u(e){return!a(e)}function c(e){return"count"===e.aggregate}function s(e,t){if(null!=e.title)return e.title;if(c(e))return t.countTitle;var n=e.aggregate||e.timeUnit||e.bin&&"bin";return n?n.toString().toUpperCase()+"("+e.field+")":e.field}function l(e,t){if(e.timeUnit)return"temporal";if(e.bin)return"quantitative";switch(p.rangeType(t)){case"continuous":return"quantitative";case"discrete":return"nominal";case"flexible":return"nominal";default:return"quantitative"}}function d(e,t){if(r(e)){var n=h.getFullName(e.type);if(n)e.type=n;else{var i=l(e,t);y.warn(y.message.emptyOrInvalidFieldType(e.type,t,i)),e.type=i}var o=f(e,t),a=o.compatible,u=o.warning;a||y.warn(u)}return e}function f(e,t){switch(t){case"row":case"column":return u(e)&&!e.timeUnit?{compatible:!1,warning:y.message.facetChannelShouldBeDiscrete(t)}:m;case"x":case"y":case"color":case"text":case"detail":return m;case"opacity":case"size":case"x2":case"y2":return a(e)&&!e.bin?{compatible:!1,warning:"Channel "+t+" should not be used with discrete field."}:m;case"shape":return"nominal"!==e.type?{compatible:!1,warning:"Shape channel should be used with nominal data only"}:m;case"order":return"nominal"===e.type?{compatible:!1,warning:"Channel order is inappropriate for nominal field, which has no inherent order."}:m}throw new Error("channelCompatability not implemented for channel "+t)}Object.defineProperty(n,"__esModule",{value:!0});var p=e("./channel"),y=e("./log"),g=e("./timeunit"),h=e("./type");n.isFieldDef=r,n.isValueDef=i,n.field=o,n.isDiscrete=a,n.isContinuous=u,n.isCount=c,n.title=s,n.defaultType=l,n.normalize=d;var m={compatible:!0};n.channelCompatibility=f},{"./channel":53,"./log":58,"./timeunit":61,"./type":62}],57:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.defaultLegendConfig={orient:void 0},n.LEGEND_PROPERTIES=["entryPadding","format","offset","orient","tickCount","title","type","values","zindex"]},{}],58:[function(e,t,n){"use strict";function r(e){var t=f=new p;e(t),a()}function i(e){return function(){var t=f=new p;e(t),a()}}function o(e){return f=e}function a(){return f=d}function u(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];f.warn.apply(f,arguments)}function c(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];f.info.apply(f,arguments)}function s(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];f.debug.apply(f,arguments)}Object.defineProperty(n,"__esModule",{value:!0});var l=e("vega-util"),d=l.logger(l.Warn),f=d,p=function(){function e(){this.warns=[],this.infos=[],this.debugs=[]}return e.prototype.level=function(){return this},e.prototype.warn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return(n=this.warns).push.apply(n,e),this;var n},e.prototype.info=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return(n=this.infos).push.apply(n,e),this;var n},e.prototype.debug=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return(n=this.debugs).push.apply(n,e),this;var n},e}();n.LocalLogger=p,n.runLocalLogger=r,n.wrap=i,n.set=o,n.reset=a,n.warn=u,n.info=c,n.debug=s;var y;!function(e){function t(e){return'Invalid field type "'+e+'"'}function n(e,t,n){return"Invalid field type ("+e+") for channel "+t+", using "+n+" instead."}function r(e,t){return"Dropping "+JSON.stringify(e)+" from channel "+t+" since it does not contain data field or value."}function i(e,t,n){return e+" dropped as it is incompatible with "+t+n?"when "+n:""}function o(e){return e+" encoding should be discrete (ordinal / nominal / binned)."}function a(e,t){return"Using discrete channel "+e+" to encode "+t+" field can be misleading as it does not encode "+("ordinal"===t?"order":"magnitude")+"."}function u(e){return"Cannot clearly determine orientation for "+e+" since both x and y channel encode continous fields. In this case, we use vertical by default"}function c(e){return"Cannot clearly determine orientation for "+e+" since both x and y channel encode discrete or empty fields."}function s(e,t){return"Specified orient "+e+" overridden with "+t}function l(e){return"Cannot use "+e+" with non-color channel."}function d(e){return"Using unaggregated domain with raw field has no effect ("+JSON.stringify(e)+")."}function f(e){return"Unaggregated domain not applicable for "+e+" since it produces values outside the origin domain of the source data."}function p(e){return"Unaggregated domain is currently unsupported for log scale ("+JSON.stringify(e)+")."}function y(e){return"Cannot use custom "+e+" with row or column channel. Please use width, height, or spacing instead."}function g(e){return"rangeStep for "+e+" is dropped as top-level "+("x"===e?"width":"height")+" is provided."}function h(e,t){return"Cannot override scale type for binned channel "+e+". We are using "+t+" scale instead."}function m(e,t,n){return"Channel "+e+" does not work with "+t+" scale. We are using "+n+" scale instead."}function v(e,t,n){return n+"-scale's \""+t+'" is dropped as it does not work with '+e+" scale."}function E(e,t){return'Scale type "'+t+'" does not work with mark '+e+"."}function T(e){return"Cannot stack "+e+" if there is already "+e+"2"}function N(e){return"Cannot stack non-linear scale ("+e+")"}function S(e){return"Cannot stack when the aggregate function is non-summative ("+e+")"}function A(e,t){return"Invalid "+e+": "+t}function O(e){return'Time unit "'+e+'" is not supported. We are replacing it with '+(e+"").replace("day","date")+"."}function C(e){return"Dropping day from datetime "+JSON.stringify(e)+" as day cannot be combined with other units."}e.INVALID_SPEC="Invalid spec",e.DEPRECATED_FILTER_NULL="filterNull is deprecated. Please use filterInvalid instead.",e.invalidFieldType=t,e.emptyOrInvalidFieldType=n,e.emptyFieldDef=r,e.incompatibleChannel=i,e.facetChannelShouldBeDiscrete=o,e.discreteChannelCannotEncode=a,e.BAR_WITH_POINT_SCALE_AND_RANGESTEP_NULL="Bar mark should not be used with point scale when rangeStep is null. Please use band scale instead.",e.unclearOrientContinuous=u,e.unclearOrientDiscreteOrEmpty=c,e.orientOverridden=s,e.CANNOT_UNION_CUSTOM_DOMAIN_WITH_FIELD_DOMAIN="custom domain scale cannot be unioned with default field-based domain",e.cannotUseScalePropertyWithNonColor=l,e.unaggregateDomainHasNoEffectForRawField=d,e.unaggregateDomainWithNonSharedDomainOp=f,e.unaggregatedDomainWithLogScale=p,e.CANNOT_USE_RANGE_WITH_POSITION="Cannot use custom range with x or y channel.  Please customize width, height, padding, or rangeStep instead.",e.CANNOT_USE_PADDING_WITH_FACET="Cannot use padding with facet's scale.  Please use spacing instead.",e.cannotUseRangePropertyWithFacet=y,e.rangeStepDropped=g,e.cannotOverrideBinScaleType=h,e.scaleTypeNotWorkWithChannel=m,e.scalePropertyNotWorkWithScaleType=v,e.scaleTypeNotWorkWithMark=E,e.INVAID_DOMAIN="Invalid scale domain",e.UNABLE_TO_MERGE_DOMAINS="Unable to merge domains",e.INVALID_CHANNEL_FOR_AXIS="Invalid channel for axis.",e.cannotStackRangedMark=T,e.cannotStackNonLinearScale=N,e.cannotStackNonSummativeAggregate=S,e.invalidTimeUnit=A,e.dayReplacedWithDate=O,e.droppedDay=C}(y=n.message||(n.message={}))},{"vega-util":64}],59:[function(e,t,n){"use strict";function r(e){return e.type}function i(e){var t=r(e)?e.type:e;return t in u}Object.defineProperty(n,"__esModule",{value:!0});var o,a=e("./util");!function(e){e.AREA="area",e.BAR="bar",e.LINE="line",e.POINT="point",e.RECT="rect",e.RULE="rule",e.TEXT="text",e.TICK="tick",e.CIRCLE="circle",e.SQUARE="square"}(o=n.Mark||(n.Mark={})),n.AREA=o.AREA,n.BAR=o.BAR,n.LINE=o.LINE,n.POINT=o.POINT,n.TEXT=o.TEXT,n.TICK=o.TICK,n.RECT=o.RECT,n.RULE=o.RULE,n.CIRCLE=o.CIRCLE,n.SQUARE=o.SQUARE,n.PRIMITIVE_MARKS=[n.AREA,n.BAR,n.LINE,n.POINT,n.TEXT,n.TICK,n.RECT,n.RULE,n.CIRCLE,n.SQUARE],n.isMarkDef=r;var u=a.toSet(n.PRIMITIVE_MARKS);n.isPrimitiveMark=i,n.STROKE_CONFIG=["stroke","strokeWidth","strokeDash","strokeDashOffset","strokeOpacity"],n.FILL_CONFIG=["fill","fillOpacity"],n.FILL_STROKE_CONFIG=[].concat(n.STROKE_CONFIG,n.FILL_CONFIG),n.defaultMarkConfig={color:"#4c78a8"},n.defaultBarConfig={binSpacing:1,continuousBandSize:2},n.defaultTextConfig={baseline:"middle"},n.defaultTickConfig={thickness:1}},{"./util":63}],60:[function(e,t,n){"use strict";function r(e){return e in g}function i(e){return e in h}function o(e){return e in y}function a(e){return e in p}function u(e){return e&&!!e.name}function c(e,t){switch(t){case"type":case"domain":case"range":case"scheme":return!0;case"interpolate":return"linear"===e||"bin-linear"===e;case"round":return a(e)||"band"===e||"point"===e;case"rangeStep":case"padding":case"paddingOuter":return f.contains(["point","band"],e);case"paddingInner":return"band"===e;case"clamp":return a(e)||"sequential"===e;case"nice":return a(e)||"sequential"===e||"quantize"===e;case"exponent":return"pow"===e||"log"===e;case"zero":return"bin-ordinal"===e||!r(e)&&!f.contains(["log","time","utc"],e)}throw new Error("Invalid scale property "+t+".")}function s(e,t){switch(t){case"range":if("x"===e||"y"===e)return d.message.CANNOT_USE_RANGE_WITH_POSITION;if("row"===e||"column"===e)return d.message.cannotUseRangePropertyWithFacet("range");return;case"rangeStep":if("row"===e||"column"===e)return d.message.cannotUseRangePropertyWithFacet("rangeStep");return;case"padding":case"paddingInner":case"paddingOuter":if("row"===e||"column"===e)return d.message.CANNOT_USE_PADDING_WITH_FACET;return;case"interpolate":case"scheme":if("color"!==e)return d.message.cannotUseScalePropertyWithNonColor(e);return;case"type":case"domain":case"round":case"clamp":case"exponent":case"nice":case"zero":return}throw new Error('Invalid scale property "${propName}".');
}Object.defineProperty(n,"__esModule",{value:!0});var l,d=e("./log"),f=e("./util");!function(e){e.LINEAR="linear",e.BIN_LINEAR="bin-linear",e.LOG="log",e.POW="pow",e.SQRT="sqrt",e.TIME="time",e.UTC="utc",e.SEQUENTIAL="sequential",e.QUANTILE="quantile",e.QUANTIZE="quantize",e.THRESHOLD="threshold",e.ORDINAL="ordinal",e.BIN_ORDINAL="bin-ordinal",e.POINT="point",e.BAND="band"}(l=n.ScaleType||(n.ScaleType={})),n.SCALE_TYPES=["linear","bin-linear","log","pow","sqrt","time","utc","sequential","ordinal","bin-ordinal","point","band"],n.CONTINUOUS_TO_CONTINUOUS_SCALES=["linear","bin-linear","log","pow","sqrt","time","utc"];var p=f.toSet(n.CONTINUOUS_TO_CONTINUOUS_SCALES);n.CONTINUOUS_DOMAIN_SCALES=n.CONTINUOUS_TO_CONTINUOUS_SCALES.concat(["sequential"]);var y=f.toSet(n.CONTINUOUS_DOMAIN_SCALES);n.DISCRETE_DOMAIN_SCALES=["ordinal","bin-ordinal","point","band"];var g=f.toSet(n.DISCRETE_DOMAIN_SCALES),h=f.toSet(["bin-linear","bin-ordinal"]);n.TIME_SCALE_TYPES=["time","utc"],n.hasDiscreteDomain=r,n.isBinScale=i,n.hasContinuousDomain=o,n.isContinuousToContinuous=a,n.defaultScaleConfig={round:!0,textXRangeStep:90,rangeStep:21,pointPadding:.5,bandPaddingInner:.1,facetSpacing:16,minFontSize:8,maxFontSize:40,minOpacity:.3,maxOpacity:.8,minSize:9,minStrokeWidth:1,maxStrokeWidth:4,shapes:["circle","square","cross","diamond","triangle-up","triangle-down"]},n.isExtendedScheme=u,n.SCALE_PROPERTIES=["type","domain","range","round","rangeStep","scheme","padding","paddingInner","paddingOuter","clamp","nice","exponent","zero","interpolate"],n.scaleTypeSupportProperty=c,n.channelScalePropertyIncompatability=s},{"./log":58,"./util":63}],61:[function(e,t,n){"use strict";function r(e){return!!g[e]}function i(e,t){var r=new Date(0,0,1,0,0,0,0);return n.SINGLE_TIMEUNITS.forEach(function(n){if(a(e,n))switch(n){case d.DAY:throw new Error("Cannot convert to TimeUnits containing 'day'");case d.YEAR:r.setFullYear(t.getFullYear());break;case d.QUARTER:r.setMonth(3*Math.floor(t.getMonth()/3));break;case d.MONTH:r.setMonth(t.getMonth());break;case d.DATE:r.setDate(t.getDate());break;case d.HOURS:r.setHours(t.getHours());break;case d.MINUTES:r.setMinutes(t.getMinutes());break;case d.SECONDS:r.setSeconds(t.getSeconds());break;case d.MILLISECONDS:r.setMilliseconds(t.getMilliseconds())}}),r}function o(e){return!!h[e]}function a(e,t){var n=e.toString(),r=t.toString(),i=n.indexOf(r);return i>-1&&(t!==d.SECONDS||0===i||"i"!==n.charAt(i-1))}function u(e,t){function r(e){return e===d.QUARTER?"(quarter("+i+")-1)":e+"("+i+")"}var i='datum["'+t+'"]',o=n.SINGLE_TIMEUNITS.reduce(function(t,n){return a(e,n)&&(t[n]=r(n)),t},{});return o.day&&p.keys(o).length>1&&(y.warn(y.message.dayReplacedWithDate(e)),delete o.day,o.date=r(d.DATE)),f.dateTimeExpr(o)}function c(e){if(e)return a(e,d.SECONDS)?"second":a(e,d.MINUTES)?"minute":a(e,d.HOURS)?"hour":a(e,d.DAY)||a(e,d.DATE)?"day":a(e,d.MONTH)?"month":a(e,d.YEAR)?"year":void 0}function s(e,t,n){if(e){var r=[],i="",o=a(e,d.YEAR);a(e,d.QUARTER)&&(i="'Q' + quarter("+t+")"),a(e,d.MONTH)&&r.push(n!==!1?"%b":"%B"),a(e,d.DAY)?r.push(n?"%a":"%A"):a(e,d.DATE)&&r.push("%d"+(o?",":"")),o&&r.push(n?"%y":"%Y");var u=[];a(e,d.HOURS)&&u.push("%H"),a(e,d.MINUTES)&&u.push("%M"),a(e,d.SECONDS)&&u.push("%S"),a(e,d.MILLISECONDS)&&u.push("%L");var c=[];return r.length>0&&c.push(r.join(" ")),u.length>0&&c.push(u.join(":")),c.length>0&&(i&&(i+=" + ' ' + "),i+="timeFormat("+t+", '"+c.join(" ")+"')"),i||void 0}}function l(e){switch(e){case"hours":case"day":case"month":case"quarter":return!0}return!1}Object.defineProperty(n,"__esModule",{value:!0});var d,f=e("./datetime"),p=e("./util"),y=e("./log");!function(e){e.YEAR="year",e.MONTH="month",e.DAY="day",e.DATE="date",e.HOURS="hours",e.MINUTES="minutes",e.SECONDS="seconds",e.MILLISECONDS="milliseconds",e.YEARMONTH="yearmonth",e.YEARMONTHDATE="yearmonthdate",e.YEARMONTHDATEHOURS="yearmonthdatehours",e.YEARMONTHDATEHOURSMINUTES="yearmonthdatehoursminutes",e.YEARMONTHDATEHOURSMINUTESSECONDS="yearmonthdatehoursminutesseconds",e.MONTHDATE="monthdate",e.HOURSMINUTES="hoursminutes",e.HOURSMINUTESSECONDS="hoursminutesseconds",e.MINUTESSECONDS="minutesseconds",e.SECONDSMILLISECONDS="secondsmilliseconds",e.QUARTER="quarter",e.YEARQUARTER="yearquarter",e.QUARTERMONTH="quartermonth",e.YEARQUARTERMONTH="yearquartermonth"}(d=n.TimeUnit||(n.TimeUnit={})),n.SINGLE_TIMEUNITS=[d.YEAR,d.QUARTER,d.MONTH,d.DAY,d.DATE,d.HOURS,d.MINUTES,d.SECONDS,d.MILLISECONDS];var g=n.SINGLE_TIMEUNITS.reduce(function(e,t){return e[t]=!0,e},{});n.isSingleTimeUnit=r,n.convert=i,n.MULTI_TIMEUNITS=[d.YEARQUARTER,d.YEARQUARTERMONTH,d.YEARMONTH,d.YEARMONTHDATE,d.YEARMONTHDATEHOURS,d.YEARMONTHDATEHOURSMINUTES,d.YEARMONTHDATEHOURSMINUTESSECONDS,d.QUARTERMONTH,d.HOURSMINUTES,d.HOURSMINUTESSECONDS,d.MINUTESSECONDS,d.SECONDSMILLISECONDS];var h=n.MULTI_TIMEUNITS.reduce(function(e,t){return e[t]=!0,e},{});n.isMultiTimeUnit=o,n.TIMEUNITS=[d.YEAR,d.QUARTER,d.MONTH,d.DAY,d.DATE,d.HOURS,d.MINUTES,d.SECONDS,d.MILLISECONDS,d.YEARQUARTER,d.YEARQUARTERMONTH,d.YEARMONTH,d.YEARMONTHDATE,d.YEARMONTHDATEHOURS,d.YEARMONTHDATEHOURSMINUTES,d.YEARMONTHDATEHOURSMINUTESSECONDS,d.QUARTERMONTH,d.HOURSMINUTES,d.HOURSMINUTESSECONDS,d.MINUTESSECONDS,d.SECONDSMILLISECONDS],n.containsTimeUnit=a,n.fieldExpr=u,n.smallestUnit=c,n.formatExpression=s,n.isDiscreteByDefault=l},{"./datetime":55,"./log":58,"./util":63}],62:[function(e,t,n){"use strict";function r(e){if(e)switch(e=e.toLowerCase()){case"q":case n.QUANTITATIVE:return"quantitative";case"t":case n.TEMPORAL:return"temporal";case"o":case n.ORDINAL:return"ordinal";case"n":case n.NOMINAL:return"nominal"}}Object.defineProperty(n,"__esModule",{value:!0});var i;!function(e){e.QUANTITATIVE="quantitative",e.ORDINAL="ordinal",e.TEMPORAL="temporal",e.NOMINAL="nominal"}(i=n.Type||(n.Type={})),n.QUANTITATIVE=i.QUANTITATIVE,n.ORDINAL=i.ORDINAL,n.TEMPORAL=i.TEMPORAL,n.NOMINAL=i.NOMINAL,n.getFullName=r},{}],63:[function(e,t,n){"use strict";function r(e,t){var n={};return t.forEach(function(t){e.hasOwnProperty(t)&&(n[t]=e[t])}),n}function i(e,t){var n=v(e);return t.forEach(function(e){delete n[e]}),n}function o(e){return S.isString(e)||S.isNumber(e)||E(e)?String(e):T(e)}function a(e,t){return e.indexOf(t)>-1}function u(e,t){return e.filter(function(e){return!a(t,e)})}function c(e,t){return e.concat(u(t,e))}function s(e,t,n,r){if(e.reduce)return e.reduce.call(r,t,n);for(var i in e)e.hasOwnProperty(i)&&(n=t.call(r,n,e[i],i,e));return n}function l(e,t){for(var n=0,r=0;r<e.length;r++)if(t(e[r],r,n++))return!0;return!1}function d(e,t){for(var n=0,r=0;r<e.length;r++)if(!t(e[r],r,n++))return!1;return!0}function f(e){return[].concat.apply([],e)}function p(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];for(var r=0,i=t;r<i.length;r++){var o=i[r];e=y(e,o)}return e}function y(e,t){if("object"!=typeof t||null===t)return e;for(var n in t)t.hasOwnProperty(n)&&void 0!==t[n]&&("object"!=typeof t[n]||S.isArray(t[n])||null===t[n]?e[n]=t[n]:"object"!=typeof e[n]||null===e[n]?e[n]=p(t[n].constructor===Array?[]:{},t[n]):p(e[n],t[n]));return e}function g(e,t){for(var n,r=[],i={},o=0,a=e;o<a.length;o++){var u=a[o];n=t(u),n in i||(i[n]=1,r.push(u))}return r}function h(e,t){for(var n in e)if(e.hasOwnProperty(n)&&t[n]&&e[n]&&t[n]!==e[n])return!0;return!1}function m(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(e[n]);return t}function v(e){return JSON.parse(JSON.stringify(e))}function E(e){return e===!0||e===!1}Object.defineProperty(n,"__esModule",{value:!0});var T=e("json-stable-stringify"),N=e("vega-util");n.extend=N.extend,n.isArray=N.isArray,n.isObject=N.isObject,n.isNumber=N.isNumber,n.isString=N.isString,n.truncate=N.truncate,n.toSet=N.toSet,n.stringValue=N.stringValue;var S=e("vega-util");n.pick=r,n.omit=i,n.hash=o,n.contains=a,n.without=u,n.union=c,n.reduce=s,n.some=l,n.every=d,n.flatten=f,n.mergeDeep=p,n.unique=g,n.differ=h,n.keys=Object.keys,n.vals=m,n.duplicate=v,n.isBoolean=E},{"json-stable-stringify":46,"vega-util":64}],64:[function(t,n,r){!function(t,i){"object"==typeof r&&"undefined"!=typeof n?i(r):"function"==typeof e&&e.amd?e(["exports"],i):i(t.vega=t.vega||{})}(this,function(e){"use strict";function t(e){return null==e?null:e.fname}function n(e){return null==e?null:e.fields}function r(e){return c(e)?"["+e.map(r)+"]":s(e)||l(e)?JSON.stringify(e).replace("\u2028","\\u2028").replace("\u2029","\\u2029"):e}function i(e,t,n){var r=[t].concat([].slice.call(n));console[e].apply(console,r)}var o=function(e,t,n){return e.fields=t||[],e.fname=n,e},a=function(e){throw Error(e)},u=function(e){function t(){o.push(l+e.substring(n,r)),l="",n=r+1}var n,r,i,o=[],u=null,c=0,s=e.length,l="";for(e+="",n=r=0;r<s;++r)if(i=e[r],"\\"===i)l+=e.substring(n,r),n=++r;else if(i===u)t(),u=null,c=-1;else{if(u)continue;n===c&&'"'===i?(n=r+1,u=i):n===c&&"'"===i?(n=r+1,u=i):"."!==i||c?"["===i?(r>n&&t(),c=n=r+1):"]"===i&&(c||a("Access path missing open bracket: "+e),c>0&&t(),c=0,n=r+1):r>n?t():n=r+1}return c&&a("Access path missing closing bracket: "+e),u&&a("Access path missing closing quote: "+e),r>n&&(++r,t()),o},c=Array.isArray,s=function(e){return e===Object(e)},l=function(e){return"string"==typeof e},d=function(e,t){var n=u(e),i="return _["+n.map(r).join("][")+"];";return o(Function("_",i),[e=1===n.length?n[0]:e],t||e)},f=[],p=d("id"),y=o(function(e){return e},f,"identity"),g=o(function(){return 0},f,"zero"),h=o(function(){return 1},f,"one"),m=o(function(){return!0},f,"true"),v=o(function(){return!1},f,"false"),E=0,T=1,N=2,S=3,A=function(e){var t=e||E;return{level:function(e){return arguments.length?(t=+e,this):t},warn:function(){return t>=T&&i("warn","WARN",arguments),this},info:function(){return t>=N&&i("log","INFO",arguments),this},debug:function(){return t>=S&&i("log","DEBUG",arguments),this}}},O=function(e){return null!=e?c(e)?e:[e]:[]},C=function(e,t){var n,i,a,c,s,l,d,f,p=[],y=(e=O(e)).map(function(e,t){return null==e?null:(p.push(t),u(e).map(r).join("]["))}),g=p.length-1,h=O(t),m="var u,v;return ";if(g<0)return null;for(i=0;i<=g;++i)n=p[i],a=y[n],c="(u=a["+a+"])",s="(v=b["+a+"])",l="((v=v instanceof Date?+v:v),(u=u instanceof Date?+u:u))",d="descending"!==h[n]?(f=1,-1):(f=-1,1),m+="("+c+"<"+s+"||u==null)&&v!=null?"+d+":(u>v||v==null)&&u!=null?"+f+":"+l+"!==u&&v===v?"+d+":v!==v&&u===u?"+f+(n<g?":":":0");return o(Function("a","b",m+";"),e.filter(function(e){return null!=e}))},P=function(e){return"function"==typeof e},I=function(e){return P(e)?e:function(){return e}},b=function(e){for(var t,n,r=1,i=arguments.length;r<i;++r){t=arguments[r];for(n in t)e[n]=t[n]}return e},R=function(e,t){var n,r,i,o,a,u=-1,c=e.length;if(null==t){for(;++u<c;)if(null!=(r=e[u])&&r>=r){n=i=r;break}for(o=a=u;++u<c;)null!=(r=e[u])&&(n>r&&(n=r,o=u),i<r&&(i=r,a=u))}else{for(;++u<c;)if(null!=(r=t(e[u],u,e))&&r>=r){n=i=r;break}for(o=a=u;++u<c;)null!=(r=t(e[u],u,e))&&(n>r&&(n=r,o=u),i<r&&(i=r,a=u))}return[o,a]},M={},_=function(e){function t(e){return i.hasOwnProperty(e)&&i[e]!==M}var n,r,i={};return n={size:0,empty:0,object:i,has:t,get:function(e){return t(e)?i[e]:void 0},set:function(e,r){return t(e)||(++n.size,i[e]===M&&--n.empty),i[e]=r,this},"delete":function(e){return t(e)&&(--n.size,++n.empty,i[e]=M),this},clear:function(){n.size=n.empty=0,n.object=i={}},test:function(e){return arguments.length?(r=e,n):r},clean:function(){var e,t,o={},a=0;for(e in i)t=i[e],t===M||r&&r(t)||(o[e]=t,++a);n.size=a,n.empty=0,n.object=i=o}},e&&Object.keys(e).forEach(function(t){n.set(t,e[t])}),n},U=function(e,t){var n=e.prototype=Object.create(t.prototype);return n.constructor=e,n},D=function(e){return"number"==typeof e},L=function(e){e=e?O(e):e;var t=e&&e.length?Function("_","return ''+"+e.map(function(e){return"_["+u(e).map(r).join("][")+"]"}).join("+'|'+")+";"):function(){return""};return o(t,e,"key")},w=function(e,t,n,r){var i=t.length,o=n.length;if(!o)return t;if(!i)return n;for(var a=r||new t.constructor(i+o),u=0,c=0,s=0;u<i&&c<o;++s)a[s]=e(t[u],n[c])>0?n[c++]:t[u++];for(;u<i;++u,++s)a[s]=t[u];for(;c<o;++c,++s)a[s]=n[c];return a},x=function(e,t){for(var n="";--t>=0;)n+=e;return n},F=function(e,t,n,r){var i=n||" ",o=e+"",a=t-o.length;return a<=0?o:"left"===r?x(i,a)+o:"center"===r?x(i,~~(a/2))+o+x(i,Math.ceil(a/2)):o+x(i,a)},k=function(e){return e[e.length-1]},H=function(e){for(var t={},n=0,r=e.length;n<r;++n)t[e[n]]=1;return t},W=function(e,t,n,r){var i=null!=r?r:"…",o=e+"",a=o.length,u=Math.max(0,t-i.length);return a<=t?o:"left"===n?i+o.slice(a-u):"center"===n?o.slice(0,Math.ceil(u/2))+i+o.slice(a-~~(u/2)):o.slice(0,u)+i},B=function(e,t,n){if(e){var r,i=0,o=e.length;if(t)for(;i<o;++i)(r=t(e[i]))&&n(r,i,e);else e.forEach(n)}};e.accessor=o,e.accessorName=t,e.accessorFields=n,e.id=p,e.identity=y,e.zero=g,e.one=h,e.truthy=m,e.falsy=v,e.logger=A,e.None=E,e.Warn=T,e.Info=N,e.Debug=S,e.array=O,e.compare=C,e.constant=I,e.error=a,e.extend=b,e.extentIndex=R,e.fastmap=_,e.field=d,e.inherits=U,e.isArray=c,e.isFunction=P,e.isNumber=D,e.isObject=s,e.isString=l,e.key=L,e.merge=w,e.pad=F,e.peek=k,e.repeat=x,e.splitAccessPath=u,e.stringValue=r,e.toSet=H,e.truncate=W,e.visitArray=B,Object.defineProperty(e,"__esModule",{value:!0})})},{}]},{},[6])(6)});
//# sourceMappingURL=build/compassql.min.js.map
